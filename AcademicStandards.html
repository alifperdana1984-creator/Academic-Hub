﻿﻿<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eduversal Academic Standards</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml;charset=utf-8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%230a0a1a'/><polygon points='10,45 50,65 50,70 10,50' fill='%234e3db8'/><polygon points='90,45 50,65 50,70 90,50' fill='%235a4bd1'/><polygon points='50,25 90,45 50,65 10,45' fill='%236c5ce7'/><line x1='85' y1='46' x2='85' y2='68' stroke='%23ffd93d' stroke-width='4' stroke-linecap='round'/><circle cx='85' cy='72' r='3.5' fill='%23ffd93d'/></svg>"
    />
    <script>
      window.ENV = {
        FIREBASE_API_KEY: "__FIREBASE_API_KEY__",
        FIREBASE_AUTH_DOMAIN: "__FIREBASE_AUTH_DOMAIN__",
        FIREBASE_PROJECT_ID: "__FIREBASE_PROJECT_ID__",
        FIREBASE_STORAGE_BUCKET: "__FIREBASE_STORAGE_BUCKET__",
        FIREBASE_MESSAGING_SENDER_ID: "__FIREBASE_MESSAGING_SENDER_ID__",
        FIREBASE_APP_ID: "__FIREBASE_APP_ID__",
        CLAUDE_API_KEY: "__CLAUDE_API_KEY__",
      };
    </script>
    <script type="module" src="auth-guard.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons@4.29.0/dist/feather.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@1.8.5/umd/Recharts.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useMemo, useRef, useEffect } = React;

      // Map PascalCase names to feather kebab-case names
      const iconNameMap = {
        ScrollText: "file-text",
        Scale: "sliders",
        GraduationCap: "award",
        Target: "target",
        BookOpen: "book-open",
        BarChart3: "bar-chart-2",
        Users: "users",
        Heart: "heart",
        Shield: "shield",
        ClipboardList: "clipboard",
        DoorOpen: "log-in",
        UserCog: "user",
        Settings: "settings",
        Lock: "lock",
        AlertTriangle: "alert-triangle",
        Building: "home",
        CheckCircle: "check-circle",
        Award: "award",
        FileStack: "layers",
        Library: "book",
        Laptop: "monitor",
        Ruler: "edit-3",
        Handshake: "users",
        X: "x",
        Menu: "menu",
        Sun: "sun",
        Moon: "moon",
        Search: "search",
        Home: "home",
        Clock: "clock",
        Tag: "tag",
        FileText: "file-text",
        ArrowLeft: "arrow-left",
        ExternalLink: "external-link",
        ChevronDown: "chevron-down",
        ChevronRight: "chevron-right",
      };

      // Icon wrapper component for feather icons
      const FeatherIcon = ({ name, size = 20, className = "", style = {} }) => {
        const featherName =
          iconNameMap[name] ||
          name
            .toLowerCase()
            .replace(/([a-z])([A-Z])/g, "$1-$2")
            .toLowerCase();
        const iconData = feather.icons[featherName];
        if (!iconData) {
          return (
            <span
              style={{ width: size, height: size, display: "inline-block" }}
            />
          );
        }
        const svgString = iconData.toSvg({
          width: size,
          height: size,
          class: className,
          color: style.color || "currentColor",
        });
        return (
          <span
            dangerouslySetInnerHTML={{ __html: svgString }}
            style={{
              display: "inline-flex",
              alignItems: "center",
              color: style.color,
            }}
          />
        );
      };

      // Shortcut components for commonly used icons
      const X = (props) => <FeatherIcon name="X" {...props} />;
      const Menu = (props) => <FeatherIcon name="Menu" {...props} />;
      const Sun = (props) => <FeatherIcon name="Sun" {...props} />;
      const Moon = (props) => <FeatherIcon name="Moon" {...props} />;
      const Search = (props) => <FeatherIcon name="Search" {...props} />;
      const Home = (props) => <FeatherIcon name="Home" {...props} />;
      const Clock = (props) => <FeatherIcon name="Clock" {...props} />;
      const Tag = (props) => <FeatherIcon name="Tag" {...props} />;
      const FileText = (props) => <FeatherIcon name="FileText" {...props} />;
      const ArrowLeft = (props) => <FeatherIcon name="ArrowLeft" {...props} />;
      const ExternalLink = (props) => (
        <FeatherIcon name="ExternalLink" {...props} />
      );
      const ChevronDown = (props) => (
        <FeatherIcon name="ChevronDown" {...props} />
      );
      const ChevronRight = (props) => (
        <FeatherIcon name="ChevronRight" {...props} />
      );
      const BookOpen = (props) => <FeatherIcon name="BookOpen" {...props} />;

      const indexData = {
        meta: {
          title: "Eduversal Academic Standards",
          subtitle:
            "Educational Leadership, Cambridge Standards & Quality Management",
          organization: "Yayasan Edukasi Universal Indonesia",
          version: "1.0",
          lastUpdated: "2025-01-15",
        },
        sections: [
          {
            id: "01",
            title: "Front Matter and Governance Charter",
            shortTitle: "Governance",
            icon: "ScrollText",
            color: "#1e40af",
            description:
              "Document control, vision, mission, core values, governance structure",
            tags: ["governance", "vision", "mission", "values", "board"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1aQWYzmyjAAr46KcMogGaAjPlQr_hFiFWqNyPPxSgBXc/edit?usp=drive_link",
          },
          {
            id: "02",
            title: "Legal and Regulatory Compliance",
            shortTitle: "Legal",
            icon: "Scale",
            color: "#1e3a8a",
            description: "Indonesian education law and regulatory compliance",
            tags: ["legal", "compliance", "regulations"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1Cb5JvnlAs8326mMFrQc4eF9fP1smI1d5bySb-QypGCE/edit?usp=drive_link",
          },
          {
            id: "03",
            title: "Cambridge Centre Compliance",
            shortTitle: "Cambridge",
            icon: "GraduationCap",
            color: "#166534",
            description: "Cambridge International School requirements",
            tags: ["cambridge", "accreditation", "exams"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1lcVBxsUSqiUZe2SP5STpmA8Ase3mQ9Sb58mRLdvWHtk/edit?usp=drive_link",
          },
          {
            id: "04",
            title: "Strategic Planning and School Improvement",
            shortTitle: "Strategy",
            icon: "Target",
            color: "#2563eb",
            description: "School improvement planning and KPIs",
            tags: ["strategy", "planning", "KPI", "improvement"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1glDSDMx5JjSvtxbnFBtwXLQSiheR_2z50DRlXINeips/edit?usp=drive_link",
          },
          {
            id: "05",
            title: "Curriculum Architecture",
            shortTitle: "Curriculum",
            icon: "BookOpen",
            color: "#15803d",
            description: "Curriculum design and subject frameworks",
            tags: ["curriculum", "subjects", "learning"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1jnDROQfV1WIjlqW7UhyAIvZ2Yg9oonvg0QZcamCf2oA/edit?usp=drive_link",
          },
          {
            id: "06",
            title: "Assessment and Reporting",
            shortTitle: "Assessment",
            icon: "BarChart3",
            color: "#16a34a",
            description: "Assessment policies and grading systems",
            tags: ["assessment", "grading", "reporting"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1BvvA9yxybevPYm07oWmVuLyU-Y7r69Yf8VtWjMPehrc/edit?usp=drive_link",
          },
          {
            id: "07",
            title: "Teaching Quality and Practice",
            shortTitle: "Teaching",
            icon: "Users",
            color: "#22c55e",
            description: "Teaching standards and instructional practices",
            tags: ["teaching", "quality", "pedagogy"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1kTV9nwjm5feYOikH0BTswIoBu0yZgpiZi1bwnFxpkEU/edit?usp=drive_link",
          },
          {
            id: "08",
            title: "Inclusion, EAL, and Learning Support",
            shortTitle: "Inclusion",
            icon: "Heart",
            color: "#7c3aed",
            description: "Special needs and inclusive practices",
            tags: ["inclusion", "EAL", "SEN", "support"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1fOnzb2DKYPQPjD37SzkTuReNWE224Ff5smJGKmDwnQM/edit?usp=drive_link",
          },
          {
            id: "09",
            title: "Safeguarding, Child Protection, Wellbeing",
            shortTitle: "Safeguarding",
            icon: "Shield",
            color: "#6d28d9",
            description: "Child protection and student wellbeing",
            tags: ["safeguarding", "protection", "wellbeing"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/19Bg_4EiJMGLPJcpR8EouWwzMRBC9tENue6r_66z2e5Q/edit?usp=drive_link",
          },
          {
            id: "10",
            title: "Cambridge Examinations Management",
            shortTitle: "Exams",
            icon: "ClipboardList",
            color: "#14532d",
            description: "Exam administration and results management",
            tags: ["exams", "cambridge", "results"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1c-UbwBhLOqToXqebCjAKORW9DcXvI5v8xVeq-J5n1j4/edit?usp=drive_link",
          },
          {
            id: "11",
            title: "Admissions, Enrollment, Marketing",
            shortTitle: "Admissions",
            icon: "DoorOpen",
            color: "#dc2626",
            description: "Student admissions and enrollment",
            tags: ["admissions", "enrollment", "marketing"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/13JSTngw3PUhpnVYd7miYuuCGERJqj0R0VlfY8-ftZKc/edit?usp=drive_link",
          },
          {
            id: "12",
            title: "Staff Lifecycle",
            shortTitle: "Staff",
            icon: "UserCog",
            color: "#ea580c",
            description: "HR, recruitment, and staff management",
            tags: ["HR", "recruitment", "appraisal", "staff"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1To9QgFfIh_nJXi3uv_v6Hsoqr2oNIGUzuGjHtDNTRc0/edit?usp=drive_link",
          },
          {
            id: "13",
            title: "Operations, Finance, Resources",
            shortTitle: "Operations",
            icon: "Settings",
            color: "#f97316",
            description: "Operational and financial management",
            tags: ["operations", "finance", "budget"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1ibSOeRkw00rqeYDwBE2JO9Y2dA6cA5XTdWeZSMbscZY/edit?usp=drive_link",
          },
          {
            id: "14",
            title: "Data Protection and Records",
            shortTitle: "Data",
            icon: "Lock",
            color: "#fb923c",
            description: "Data privacy and information management",
            tags: ["data", "privacy", "records", "pdp"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1pKUfHe9aE4g8VfNuMqMRK3dy9KMarcq9CjF6u-QrL0s/edit?usp=drive_link",
          },
          {
            id: "15",
            title: "Risk Management and Emergency",
            shortTitle: "Risk",
            icon: "AlertTriangle",
            color: "#c2410c",
            description: "Risk assessment and emergency procedures",
            tags: ["risk", "emergency", "continuity"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1HkiDrnqy7rY3bKYCjj8P-_Y2PqNl7VqiUHr5BG5bC-I/edit?usp=drive_link",
          },
          {
            id: "16",
            title: "Parent and Community Engagement",
            shortTitle: "Community",
            icon: "Building",
            color: "#ef4444",
            description: "Stakeholder engagement and communication",
            tags: ["parents", "community", "engagement"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1AHmTk2PTsuQp8YQK3yZdu8KfFChGZyhMlE8vKh7ZYoA/edit?usp=drive_link",
          },
          {
            id: "17",
            title: "Quality Assurance and Review",
            shortTitle: "QA",
            icon: "CheckCircle",
            color: "#3b82f6",
            description: "Quality management and internal review",
            tags: ["quality", "QA", "review", "audit"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1RAm-c4UO2FRW3XghF111Za-Oy1Kuj62VkWL8-jszcKk/edit?usp=drive_link",
          },
          {
            id: "18",
            title: "Accreditation Toolkit (CIS/WASC)",
            shortTitle: "Accreditation",
            icon: "Award",
            color: "#b91c1c",
            description: "A practical guide for CIS and WASC self-study",
            tags: ["accreditation", "CIS", "WASC"],
            status: "complete",
            docUrl:
              "https://docs.google.com/document/d/1WQRPMLkSGSfWMDD9yI1AADKvwlz3-gWJXh0M3DGDBxQ/edit?usp=drive_link",
          },
          {
            id: "19",
            title: "Templates and Tools",
            shortTitle: "Templates",
            icon: "FileStack",
            color: "#78350f",
            description: "Operational templates and forms",
            tags: ["templates", "forms", "tools"],
            status: "skeleton",
            docUrl:
              "https://docs.google.com/document/d/1ToKNoxKH9WafL6Nv38NCrCEscjKWOBbWNsECpWFKrBM/edit?usp=drive_link",
          },
          {
            id: "20",
            title: "References and Compliance Library",
            shortTitle: "References",
            icon: "Library",
            color: "#92400e",
            description: "Reference documents and resources",
            tags: ["references", "library", "resources"],
            status: "skeleton",
            docUrl:
              "https://docs.google.com/document/d/1g1l8QWFb75B0zgDWLq-wY3Mga7ZKzSwiMhbtOAvX46M/edit?usp=drive_link",
          },
          {
            id: "21",
            title: "Digital Learning and Technology",
            shortTitle: "Technology",
            icon: "Laptop",
            color: "#a16207",
            description: "EdTech and IT infrastructure",
            tags: ["technology", "digital", "EdTech"],
            status: "skeleton",
            docUrl:
              "https://docs.google.com/document/d/1hDIdZfS7LYM4kNAlqhat_fSx247OMzPgWaaTIghmynY/edit?usp=drive_link",
          },
          {
            id: "22",
            title: "Student Conduct and Discipline",
            shortTitle: "Conduct",
            icon: "Ruler",
            color: "#8b5cf6",
            description: "Behavior management and discipline",
            tags: ["conduct", "discipline", "behavior"],
            status: "skeleton",
            docUrl:
              "https://docs.google.com/document/d/11gzVImHonsdmS4jCFVsaBCek2vs2qnBHAxLfqpJ9Eb0/edit?usp=drive_link",
          },
          {
            id: "23",
            title: "External Partnerships and Pathways",
            shortTitle: "Partnerships",
            icon: "Handshake",
            color: "#f87171",
            description: "University partnerships and career pathways",
            tags: ["partnerships", "university", "careers"],
            status: "skeleton",
            docUrl:
              "https://docs.google.com/document/d/1Kgilip1jXRphibINwSuQeSpc31pj_yqriCefnrVNk8Y/edit?usp=drive_link",
          },
        ],
      };

      const Icon = (props) => <FeatherIcon {...props} />;

      const ContentBlock = ({ block, dark }) => {
        const base = dark ? "text-gray-200" : "text-gray-700";
        const heading = dark ? "text-white" : "text-gray-900";
        const muted = dark ? "text-gray-400" : "text-gray-500";
        const card = dark
          ? "bg-gray-800 border-gray-700"
          : "bg-white border-gray-200";
        const cardAlt = dark ? "bg-gray-700/50" : "bg-gray-50";

        switch (block.type) {
          case "info":
            return (
              <div
                className={`p-4 rounded-lg mb-4 ${
                  dark
                    ? "bg-blue-900/30 border border-blue-800"
                    : "bg-blue-50 border border-blue-200"
                }`}
              >
                <span
                  className={`text-sm font-semibold ${
                    dark ? "text-blue-300" : "text-blue-600"
                  }`}
                >
                  {block.label}
                </span>
                <p className={`mt-1 ${base}`}>{block.text}</p>
              </div>
            );
          case "table":
            return (
              <div className="mb-5">
                <h4 className={`font-semibold mb-2 ${heading}`}>
                  {block.title}
                </h4>
                <div className={`rounded-lg overflow-hidden border ${card}`}>
                  {block.rows.map(([k, v], i) => (
                    <div
                      key={i}
                      className={`flex border-b last:border-0 ${
                        dark ? "border-gray-700" : "border-gray-200"
                      }`}
                    >
                      <div
                        className={`w-1/3 p-2.5 text-sm font-medium ${cardAlt}`}
                      >
                        {k}
                      </div>
                      <div className={`w-2/3 p-2.5 text-sm ${base}`}>{v}</div>
                    </div>
                  ))}
                </div>
              </div>
            );
          case "list":
            return (
              <div className="mb-5">
                <h4 className={`font-semibold mb-2 ${heading}`}>
                  {block.title}
                </h4>
                <ul className={`space-y-1.5 ${base}`}>
                  {block.items.map((item, i) => (
                    <li key={i} className="flex items-start">
                      <span className="mr-2 mt-1.5 w-1.5 h-1.5 rounded-full bg-emerald-500 flex-shrink-0"></span>
                      <span className="text-sm">{item}</span>
                    </li>
                  ))}
                </ul>
              </div>
            );
          case "numbered":
            return (
              <div className="mb-5">
                <h4 className={`font-semibold mb-2 ${heading}`}>
                  {block.title}
                </h4>
                <ol className={`space-y-1.5 ${base}`}>
                  {block.items.map((item, i) => (
                    <li key={i} className="flex items-start">
                      <span
                        className={`mr-2 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 ${
                          dark
                            ? "bg-emerald-700 text-emerald-100"
                            : "bg-emerald-100 text-emerald-700"
                        }`}
                      >
                        {i + 1}
                      </span>
                      <span className="text-sm pt-0.5">{item}</span>
                    </li>
                  ))}
                </ol>
              </div>
            );
          case "link":
            return (
              <div className="mb-5">
                <a
                  href={block.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                    dark
                      ? "bg-blue-600 hover:bg-blue-500 text-white"
                      : "bg-blue-50 hover:bg-blue-100 text-blue-700"
                  }`}
                >
                  <ExternalLink size={16} />
                  {block.text}
                </a>
              </div>
            );
          case "vision":
            return (
              <div
                className={`p-5 rounded-lg mb-5 border-l-4 ${
                  dark
                    ? "bg-gradient-to-r from-blue-900/40 to-indigo-900/40 border-blue-400"
                    : "bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-500"
                }`}
              >
                <h3 className={`text-lg font-bold ${heading}`}>
                  {block.title}
                </h3>
                <p className={`text-xs mb-2 ${muted}`}>{block.subtitle}</p>
                <p className={`text-sm leading-relaxed ${base}`}>
                  {block.text}
                </p>
              </div>
            );
          case "mission":
            return (
              <div
                className={`p-5 rounded-lg mb-5 border-l-4 ${
                  dark
                    ? "bg-gradient-to-r from-emerald-900/40 to-teal-900/40 border-emerald-400"
                    : "bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-500"
                }`}
              >
                <h3 className={`text-lg font-bold ${heading}`}>
                  {block.title}
                </h3>
                <p className={`text-xs mb-3 ${muted}`}>{block.subtitle}</p>
                <ol className={`space-y-2 ${base}`}>
                  {block.items.map((item, i) => (
                    <li key={i} className="flex items-start text-sm">
                      <span
                        className={`mr-2 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 ${
                          dark ? "bg-white/20" : "bg-white"
                        }`}
                      >
                        {i + 1}
                      </span>
                      {item}
                    </li>
                  ))}
                </ol>
              </div>
            );
          case "values":
            return (
              <div className="mb-5">
                <h3 className={`text-lg font-bold mb-3 ${heading}`}>
                  {block.title}
                </h3>
                <div className="grid grid-cols-2 gap-3">
                  {block.items.map((v, i) => (
                    <div key={i} className={`p-3 rounded-lg border ${card}`}>
                      <div className="flex items-center gap-2 mb-1">
                        <span
                          className={`font-bold text-sm ${
                            dark ? "text-emerald-400" : "text-emerald-600"
                          }`}
                        >
                          {v.name}
                        </span>
                        <span className={`text-xs ${muted}`}>({v.id})</span>
                      </div>
                      <p className={`text-xs ${base}`}>{v.desc}</p>
                    </div>
                  ))}
                </div>
              </div>
            );
          case "slos":
            return (
              <div className="mb-5">
                <h3 className={`text-lg font-bold mb-3 ${heading}`}>
                  {block.title}
                </h3>
                <div className="space-y-3">
                  {block.items.map((slo, i) => (
                    <div key={i} className={`p-3 rounded-lg border ${card}`}>
                      <div className="flex items-center gap-2 mb-2">
                        <span
                          className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${
                            dark ? "bg-blue-600" : "bg-blue-500"
                          } text-white`}
                        >
                          {slo.n}
                        </span>
                        <span className={`font-semibold text-sm ${heading}`}>
                          {slo.name}
                        </span>
                      </div>
                      <ul className={`ml-8 space-y-1 ${base}`}>
                        {slo.points.map((p, j) => (
                          <li key={j} className="text-xs flex items-start">
                            <span className="mr-1.5 text-emerald-500">â€¢</span>
                            {p}
                          </li>
                        ))}
                      </ul>
                    </div>
                  ))}
                </div>
              </div>
            );
          case "text":
            return (
              <div className="mb-5">
                <h4 className={`font-semibold mb-2 ${heading}`}>
                  {block.title}
                </h4>
                <p className={`text-sm ${base}`}>{block.text}</p>
              </div>
            );
          case "levels":
            return (
              <div className="mb-5">
                <h3 className={`text-lg font-bold mb-3 ${heading}`}>
                  {block.title}
                </h3>
                {block.levels.map((lvl, li) => (
                  <div
                    key={li}
                    className={`mb-4 p-4 rounded-lg border ${card}`}
                  >
                    <div
                      className={`flex items-center gap-2 mb-3 pb-2 border-b ${
                        dark ? "border-gray-700" : "border-gray-200"
                      }`}
                    >
                      <span
                        className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${
                          dark ? "bg-blue-600" : "bg-blue-500"
                        } text-white`}
                      >
                        {lvl.level}
                      </span>
                      <div>
                        <span className={`font-bold text-sm ${heading}`}>
                          {lvl.name}
                        </span>
                        {lvl.entity && (
                          <p className={`text-xs ${muted}`}>{lvl.entity}</p>
                        )}
                      </div>
                    </div>
                    {lvl.roles.map((role, ri) => (
                      <div key={ri} className={`mb-3 p-2 rounded ${cardAlt}`}>
                        <div className="flex items-center gap-2 mb-1">
                          <span
                            className={`font-semibold text-sm ${
                              dark ? "text-emerald-400" : "text-emerald-600"
                            }`}
                          >
                            {role.title}
                          </span>
                          {role.details && (
                            <span className={`text-xs ${muted}`}>
                              â€” {role.details}
                            </span>
                          )}
                        </div>
                        <ul className={`space-y-0.5 ${base}`}>
                          {role.resp.map((r, rri) => (
                            <li key={rri} className="text-xs flex items-start">
                              <span className="mr-1.5 text-emerald-500">
                                â€¢
                              </span>
                              {r}
                            </li>
                          ))}
                        </ul>
                      </div>
                    ))}
                  </div>
                ))}
              </div>
            );
          case "roles":
            return (
              <div className="mb-5">
                <h4 className={`font-semibold mb-3 ${heading}`}>
                  {block.title}
                </h4>
                <div className="space-y-3">
                  {block.roles.map((role, i) => (
                    <div key={i} className={`p-3 rounded-lg border ${card}`}>
                      <div className="flex items-center gap-2 mb-1">
                        <span
                          className={`font-semibold text-sm ${
                            dark ? "text-blue-400" : "text-blue-600"
                          }`}
                        >
                          {role.title}
                        </span>
                        {role.id && (
                          <span className={`text-xs ${muted}`}>
                            ({role.id})
                          </span>
                        )}
                        {role.note && (
                          <span
                            className={`text-xs px-1.5 py-0.5 rounded ${
                              dark
                                ? "bg-yellow-900/50 text-yellow-300"
                                : "bg-yellow-100 text-yellow-700"
                            }`}
                          >
                            {role.note}
                          </span>
                        )}
                      </div>
                      <ul className={`space-y-0.5 ${base}`}>
                        {role.resp.map((r, ri) => (
                          <li key={ri} className="text-xs flex items-start">
                            <span className="mr-1.5 text-emerald-500">â€¢</span>
                            {r}
                          </li>
                        ))}
                      </ul>
                    </div>
                  ))}
                </div>
              </div>
            );
          case "note":
            return (
              <div
                className={`p-4 rounded-lg mb-4 ${
                  dark
                    ? "bg-yellow-900/20 border border-yellow-800"
                    : "bg-yellow-50 border border-yellow-200"
                }`}
              >
                <p
                  className={`text-sm ${
                    dark ? "text-yellow-200" : "text-yellow-800"
                  }`}
                >
                  ðŸ“Œ {block.text}
                </p>
              </div>
            );
          case "policy":
            return (
              <div className="mb-5">
                <div
                  className={`p-3 rounded-lg mb-3 ${
                    dark ? "bg-blue-900/30" : "bg-blue-50"
                  }`}
                >
                  <p className={`text-sm ${base}`}>
                    <strong>Purpose:</strong> {block.purpose}
                  </p>
                  <p className={`text-sm mt-1 ${base}`}>
                    <strong>Scope:</strong> {block.scope}
                  </p>
                </div>
                <h5 className={`font-semibold text-sm mb-2 ${heading}`}>
                  Examples:
                </h5>
                <ul className={`mb-3 space-y-1 ${base}`}>
                  {block.examples.map((e, i) => (
                    <li key={i} className="text-xs flex items-start">
                      <span className="mr-1.5 text-red-500">âš </span>
                      {e}
                    </li>
                  ))}
                </ul>
                <h5 className={`font-semibold text-sm mb-2 ${heading}`}>
                  Procedures:
                </h5>
                <div className="space-y-2">
                  {block.steps.map((s, i) => (
                    <div key={i} className="flex items-start">
                      <span
                        className={`mr-2 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 ${
                          dark ? "bg-blue-600" : "bg-blue-500"
                        } text-white`}
                      >
                        {s.n}
                      </span>
                      <div>
                        <span className={`font-medium text-sm ${heading}`}>
                          {s.title}:{" "}
                        </span>
                        <span className={`text-xs ${base}`}>{s.desc}</span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          case "process":
            return (
              <div className="mb-5">
                <h4 className={`font-semibold mb-1 ${heading}`}>
                  {block.title}
                </h4>
                <p className={`text-xs mb-3 ${muted}`}>{block.purpose}</p>
                <div className="space-y-2">
                  {block.steps.map((s, i) => (
                    <div
                      key={i}
                      className={`flex items-start p-2 rounded ${cardAlt}`}
                    >
                      <span
                        className={`mr-2 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 ${
                          dark ? "bg-emerald-600" : "bg-emerald-500"
                        } text-white`}
                      >
                        {s.n}
                      </span>
                      <div>
                        <span className={`font-medium text-sm ${heading}`}>
                          {s.title}
                        </span>
                        <p className={`text-xs ${base}`}>{s.desc}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          case "org":
            return (
              <div className="mb-5">
                <h4 className={`font-semibold mb-3 ${heading}`}>
                  {block.title}
                </h4>
                <div className="flex flex-col items-center space-y-2 mb-4">
                  {block.levels.map((l, i) => (
                    <div
                      key={i}
                      className={`px-4 py-2 rounded-lg text-center text-sm font-medium ${
                        i === 0
                          ? (dark ? "bg-blue-600" : "bg-blue-500") +
                            " text-white"
                          : card + " border"
                      }`}
                    >
                      {l}
                    </div>
                  ))}
                </div>
                <div className={`p-3 rounded-lg ${cardAlt}`}>
                  <p className={`text-xs font-semibold mb-2 ${muted}`}>
                    Network Support:
                  </p>
                  <div className="flex flex-wrap gap-1.5">
                    {block.support.map((s, i) => (
                      <span
                        key={i}
                        className={`text-xs px-2 py-1 rounded ${
                          dark
                            ? "bg-gray-700 text-gray-300"
                            : "bg-gray-200 text-gray-700"
                        }`}
                      >
                        {s}
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            );
          case "evidence":
            return (
              <div className="mb-5">
                {block.categories.map((cat, ci) => (
                  <div key={ci} className="mb-4">
                    <h5 className={`font-semibold text-sm mb-2 ${heading}`}>
                      {cat.title}
                    </h5>
                    <div className={`p-3 rounded-lg ${cardAlt}`}>
                      <ul className={`space-y-1 ${base}`}>
                        {cat.items.map((item, i) => (
                          <li key={i} className="text-xs flex items-start">
                            <span className="mr-1.5 text-blue-500">ðŸ“„</span>
                            {item}
                          </li>
                        ))}
                      </ul>
                    </div>
                  </div>
                ))}
              </div>
            );
          case "compliance":
            return (
              <div className="mb-5">
                {block.categories.map((cat, ci) => (
                  <div key={ci} className="mb-4">
                    <h5 className={`font-semibold text-sm mb-2 ${heading}`}>
                      {cat.title}
                    </h5>
                    <ul className={`space-y-1 ${base}`}>
                      {cat.items.map((item, i) => (
                        <li key={i} className="text-xs flex items-start">
                          <span className="mr-1.5 text-emerald-500">âœ“</span>
                          {item}
                        </li>
                      ))}
                    </ul>
                  </div>
                ))}
              </div>
            );
          default:
            return null;
        }
      };

      function App() {
        const [dark, setDark] = useState(false);
        const [sidebar, setSidebar] = useState(true);
        const [search, setSearch] = useState("");
        const [selected, setSelected] = useState(null);
        const [expandedSub, setExpandedSub] = useState(null);
        const [sectionsData, setSectionsData] = useState({});
        const [dataLoading, setDataLoading] = useState(true);

        useEffect(() => {
          const completeSections = indexData.sections.filter(
            (s) => s.status === "complete",
          );
          Promise.all(
            completeSections.map((s) =>
              fetch(`Sections/Section ${s.id}.json`)
                .then((r) => (r.ok ? r.json() : null))
                .catch(() => null),
            ),
          ).then((results) => {
            const data = {};
            completeSections.forEach((s, i) => {
              if (results[i]) data[s.id] = results[i];
            });
            setSectionsData(data);
            setDataLoading(false);
          });
        }, []);

        const bg = dark ? "bg-gray-900" : "bg-gray-100";
        const text = dark ? "text-gray-100" : "text-gray-900";
        const card = dark
          ? "bg-gray-800 border-gray-700"
          : "bg-white border-gray-200";
        const muted = dark ? "text-gray-400" : "text-gray-500";

        const filteredSections = useMemo(() => {
          if (!search) return indexData.sections;
          const q = search.toLowerCase();
          return indexData.sections.filter((s) => {
            if (s.title.toLowerCase().includes(q)) return true;
            if (s.description.toLowerCase().includes(q)) return true;
            if (s.tags.some((t) => t.toLowerCase().includes(q))) return true;
            const data = sectionsData[s.id];
            if (data) {
              const content = JSON.stringify(data).toLowerCase();
              if (content.includes(q)) return true;
            }
            return false;
          });
        }, [search, sectionsData]);

        const sectionData = selected ? sectionsData[selected] : null;
        const currentSection = indexData.sections.find(
          (s) => s.id === selected,
        );

        if (dataLoading) {
          return (
            <div
              className={`min-h-screen flex items-center justify-center ${bg}`}
            >
              <div className="text-center">
                <div
                  className="inline-block w-10 h-10 border-4 border-blue-200 border-t-blue-500 rounded-full"
                  style={{ animation: "spin 1s linear infinite" }}
                ></div>
                <p className={`mt-4 text-sm ${muted}`}>
                  Loading academic standards...
                </p>
                <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>
              </div>
            </div>
          );
        }

        return (
          <div className={`min-h-screen ${bg} ${text}`}>
            <header
              className={`fixed top-0 left-0 right-0 z-50 ${
                dark
                  ? "bg-gradient-to-r from-gray-800 to-gray-900"
                  : "bg-gradient-to-r from-white to-blue-50"
              }
       border-b ${dark ? "border-gray-700" : "border-gray-200"}`}
            >
              <div className="flex items-center justify-between px-4 py-3">
                <div className="flex items-center gap-3">
                  <button
                    onClick={() => setSidebar(!sidebar)}
                    className={`p-2 rounded-lg ${
                      dark ? "hover:bg-gray-700" : "hover:bg-gray-100"
                    }`}
                  >
                    {sidebar ? <X size={20} /> : <Menu size={20} />}
                  </button>
                  <div>
                    <h1 className="font-bold text-lg flex items-center gap-2">
                      <BookOpen size={24} className="text-blue-500" />{" "}
                      {indexData.meta.title}
                    </h1>
                    <p className={`text-xs ${muted}`}>
                      {indexData.meta.organization} â€¢ v
                      {indexData.meta.version}
                    </p>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <div className="relative">
                    <Search
                      size={16}
                      className={`absolute left-3 top-1/2 -translate-y-1/2 ${muted}`}
                    />
                    <input
                      type="text"
                      placeholder="Search..."
                      value={search}
                      onChange={(e) => setSearch(e.target.value)}
                      className={`pl-9 pr-4 py-2 rounded-lg text-sm w-40 ${
                        dark
                          ? "bg-gray-700 border-gray-600"
                          : "bg-gray-100 border-gray-200"
                      } border focus:outline-none focus:ring-2 focus:ring-blue-500`}
                    />
                  </div>
                  <button
                    onClick={() => setDark(!dark)}
                    className={`p-2 rounded-lg ${
                      dark ? "hover:bg-gray-700" : "hover:bg-gray-100"
                    }`}
                  >
                    {dark ? <Sun size={20} /> : <Moon size={20} />}
                  </button>
                </div>
              </div>
            </header>

            <div className="flex pt-16">
              {sidebar && (
                <aside
                  className={`fixed left-0 top-16 bottom-0 w-56 ${
                    dark
                      ? "bg-gradient-to-b from-gray-800 to-gray-900"
                      : "bg-gradient-to-b from-blue-50 to-indigo-100"
                  }
           border-r ${
             dark ? "border-gray-700" : "border-gray-200"
           } overflow-y-auto overflow-x-hidden z-40`}
                >
                  <nav className="p-3">
                    <button
                      onClick={() => setSelected(null)}
                      className={`w-full flex items-center gap-2 p-2 rounded-lg mb-2 text-sm font-medium ${
                        !selected
                          ? (dark ? "bg-blue-600" : "bg-blue-500") +
                            " text-white"
                          : dark
                            ? "hover:bg-gray-700"
                            : "hover:bg-gray-100"
                      }`}
                    >
                      <Home size={16} /> All Sections
                    </button>
                    <div className="space-y-1">
                      {filteredSections.map((s) => (
                        <button
                          key={s.id}
                          onClick={() => {
                            setSelected(s.id);
                            setExpandedSub(null);
                          }}
                          className={`w-full flex items-center gap-2 p-2 rounded-lg text-left text-sm ${
                            selected === s.id
                              ? dark
                                ? "bg-gray-700"
                                : "bg-gray-100"
                              : dark
                                ? "hover:bg-gray-700/50"
                                : "hover:bg-gray-50"
                          }`}
                        >
                          <Icon
                            name={s.icon}
                            size={18}
                            className={dark ? "text-gray-400" : "text-gray-500"}
                          />
                          <div className="flex-1 min-w-0">
                            <p className="font-medium truncate text-xs">
                              {s.shortTitle}
                            </p>
                          </div>
                        </button>
                      ))}
                    </div>
                  </nav>
                </aside>
              )}

              <main className={`flex-1 ${sidebar ? "ml-56" : ""} p-4`}>
                {!selected ? (
                  <div>
                    <div
                      className={`p-6 rounded-xl mb-6 border ${
                        dark
                          ? "bg-gradient-to-r from-blue-900/50 to-indigo-900/50 border-blue-700"
                          : "bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200"
                      }`}
                    >
                      <h2 className="text-2xl font-bold mb-2">
                        {indexData.meta.title}
                      </h2>
                      <p className={muted}>{indexData.meta.subtitle}</p>
                      <div
                        className={`flex items-center gap-4 mt-4 text-sm ${muted}`}
                      >
                        <span className="flex items-center gap-1">
                          <Clock size={14} /> {indexData.meta.lastUpdated}
                        </span>
                        <span className="flex items-center gap-1">
                          <Tag size={14} /> 23 Sections
                        </span>
                      </div>

                      <div className={`flex flex-wrap gap-3 mt-4 text-xs`}>
                        <span className="flex items-center gap-1">
                          <span
                            className="w-3 h-3 rounded"
                            style={{ backgroundColor: "#1e40af" }}
                          ></span>{" "}
                          Governance
                        </span>
                        <span className="flex items-center gap-1">
                          <span
                            className="w-3 h-3 rounded"
                            style={{ backgroundColor: "#166534" }}
                          ></span>{" "}
                          Academic
                        </span>
                        <span className="flex items-center gap-1">
                          <span
                            className="w-3 h-3 rounded"
                            style={{ backgroundColor: "#7c3aed" }}
                          ></span>{" "}
                          Student
                        </span>
                        <span className="flex items-center gap-1">
                          <span
                            className="w-3 h-3 rounded"
                            style={{ backgroundColor: "#ea580c" }}
                          ></span>{" "}
                          Operations
                        </span>
                        <span className="flex items-center gap-1">
                          <span
                            className="w-3 h-3 rounded"
                            style={{ backgroundColor: "#dc2626" }}
                          ></span>{" "}
                          External Relations
                        </span>
                        <span className="flex items-center gap-1">
                          <span
                            className="w-3 h-3 rounded"
                            style={{ backgroundColor: "#78350f" }}
                          ></span>{" "}
                          Resources
                        </span>
                      </div>
                    </div>
                    <div className="grid grid-cols-2 lg:grid-cols-3 gap-3">
                      {filteredSections.map((s) => (
                        <div
                          key={s.id}
                          className={`p-4 rounded-xl border ${card} transition-all duration-200 hover:shadow-lg cursor-pointer`}
                          style={{
                            borderLeftColor: s.color,
                            borderLeftWidth: "6px",
                            boxShadow: "0 2px 8px rgba(0,0,0,0.1)",
                            backgroundColor: s.color + "10",
                            border: `1px solid ${s.color}30`,
                          }}
                          onMouseEnter={(e) =>
                            (e.currentTarget.style.backgroundColor =
                              s.color + "25")
                          }
                          onMouseLeave={(e) =>
                            (e.currentTarget.style.backgroundColor =
                              s.color + "10")
                          }
                          onClick={() => {
                            setSelected(s.id);
                            setExpandedSub(null);
                          }}
                        >
                          <div className="flex items-start justify-between mb-2">
                            <div
                              className="p-2 rounded-lg cursor-pointer"
                              style={{ backgroundColor: s.color + "20" }}
                              onClick={() => {
                                setSelected(s.id);
                                setExpandedSub(null);
                              }}
                            >
                              <Icon
                                name={s.icon}
                                size={28}
                                style={{ color: s.color }}
                              />
                            </div>
                            <div className="flex items-center gap-1">
                              <a
                                href={s.docUrl}
                                target="_blank"
                                rel="noopener noreferrer"
                                className={`p-1.5 rounded-lg ${
                                  dark
                                    ? "hover:bg-gray-700 text-blue-400"
                                    : "hover:bg-gray-100 text-blue-600"
                                }`}
                                title="Open Google Doc"
                              >
                                <FileText size={16} />
                              </a>
                              <span
                                className={`text-xs px-2 py-1 rounded ${
                                  s.status === "complete"
                                    ? dark
                                      ? "bg-emerald-900/50 text-emerald-400"
                                      : "bg-emerald-100 text-emerald-600"
                                    : dark
                                      ? "bg-gray-700 text-gray-400"
                                      : "bg-gray-100 text-gray-500"
                                }`}
                              >
                                {s.status === "complete" ? "✓" : "✗"}
                              </span>
                            </div>
                          </div>
                          <button
                            onClick={() => {
                              setSelected(s.id);
                              setExpandedSub(null);
                            }}
                            className="text-left w-full"
                          >
                            <h3 className="font-bold text-sm mb-1">
                              {s.id}. {s.shortTitle}
                            </h3>
                            <p className={`text-xs ${muted}`}>
                              {s.description}
                            </p>
                          </button>
                          <div className="flex flex-wrap gap-1 mt-3">
                            {s.tags.slice(0, 3).map((tag, i) => (
                              <span
                                key={i}
                                className="text-xs px-2 py-0.5 rounded text-white"
                                style={{ backgroundColor: s.color }}
                              >
                                {tag}
                              </span>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                ) : sectionData ? (
                  <div>
                    <div className="flex items-center justify-between mb-4">
                      <button
                        onClick={() => setSelected(null)}
                        className={`flex items-center gap-2 text-sm ${
                          dark ? "text-blue-400" : "text-blue-600"
                        }`}
                      >
                        <ArrowLeft size={16} /> Back
                      </button>
                      <a
                        href={currentSection?.docUrl}
                        target="_blank"
                        rel="noopener noreferrer"
                        className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium ${
                          dark
                            ? "bg-blue-600 hover:bg-blue-500"
                            : "bg-blue-500 hover:bg-blue-600"
                        } text-white`}
                      >
                        <FileText size={16} /> Open Doc{" "}
                        <ExternalLink size={14} />
                      </a>
                    </div>
                    <div
                      className={`p-5 rounded-xl mb-4 ${
                        dark ? "bg-gray-800" : "bg-white"
                      } border ${dark ? "border-gray-700" : "border-gray-200"}`}
                    >
                      <Icon
                        name={currentSection?.icon}
                        size={36}
                        style={{ color: currentSection?.color }}
                        className="mb-2"
                      />
                      <h2 className="text-xl font-bold">
                        Section {sectionData.id}: {sectionData.title}
                      </h2>
                      <p className={`text-sm mt-1 ${muted}`}>
                        Updated: {sectionData.lastUpdated}
                      </p>
                    </div>
                    <div className="space-y-2">
                      {sectionData.subsections.map((sub) => (
                        <div
                          key={sub.id}
                          className={`rounded-xl border overflow-hidden ${card}`}
                        >
                          <button
                            onClick={() =>
                              setExpandedSub(
                                expandedSub === sub.id ? null : sub.id,
                              )
                            }
                            className={`w-full flex items-center justify-between p-3 text-left ${
                              dark ? "hover:bg-gray-700/50" : "hover:bg-gray-50"
                            }`}
                          >
                            <div className="flex items-center gap-3">
                              <span
                                className={`w-8 h-8 rounded-lg flex items-center justify-center font-bold text-xs ${
                                  dark ? "bg-blue-600" : "bg-blue-500"
                                } text-white`}
                              >
                                {sub.id}
                              </span>
                              <span className="font-semibold text-sm">
                                {sub.title}
                              </span>
                            </div>
                            {expandedSub === sub.id ? (
                              <ChevronDown size={18} />
                            ) : (
                              <ChevronRight size={18} />
                            )}
                          </button>
                          {expandedSub === sub.id && (
                            <div
                              className={`p-4 border-t ${
                                dark
                                  ? "border-gray-700 bg-gray-800/50"
                                  : "border-gray-200 bg-gray-50/50"
                              }`}
                            >
                              {sub.content.map((block, i) => (
                                <ContentBlock
                                  key={i}
                                  block={block}
                                  dark={dark}
                                />
                              ))}
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                ) : (
                  <div>
                    <div className="flex items-center justify-between mb-4">
                      <button
                        onClick={() => setSelected(null)}
                        className={`flex items-center gap-2 text-sm ${
                          dark ? "text-blue-400" : "text-blue-600"
                        }`}
                      >
                        <ArrowLeft size={16} /> Back
                      </button>
                      <a
                        href={currentSection?.docUrl}
                        target="_blank"
                        rel="noopener noreferrer"
                        className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium ${
                          dark
                            ? "bg-blue-600 hover:bg-blue-500"
                            : "bg-blue-500 hover:bg-blue-600"
                        } text-white`}
                      >
                        <FileText size={16} /> Open Doc{" "}
                        <ExternalLink size={14} />
                      </a>
                    </div>
                    <div
                      className={`p-8 rounded-xl text-center ${
                        dark ? "bg-gray-800" : "bg-white"
                      } border ${dark ? "border-gray-700" : "border-gray-200"}`}
                    >
                      <Icon
                        name={currentSection?.icon}
                        size={48}
                        style={{ color: currentSection?.color }}
                        className="mx-auto mb-4"
                      />
                      <h2 className="text-xl font-bold mb-2">
                        Section {selected}: {currentSection?.title}
                      </h2>
                      <p className={muted}>Dashboard content coming soon...</p>
                      <p
                        className={`text-sm mt-4 ${
                          dark ? "text-yellow-400" : "text-yellow-600"
                        }`}
                      >
                        ðŸ“„ Click "Open Doc" to view the full document
                      </p>
                    </div>
                  </div>
                )}
              </main>
            </div>
            <ChatBot dark={dark} sectionsData={sectionsData} />
          </div>
        );
      }

      // ── AI Chatbot Component ─────────────────────────────────────
      const ChatBot = ({ dark, sectionsData }) => {
        const [open, setOpen] = useState(false);
        const [messages, setMessages] = useState([
          {
            role: "assistant",
            content:
              "Hello! I'm the Academic Standards Assistant for Eduversal Indonesia. I can help you understand our 23-section academic standards framework. What would you like to know?\n\n(You can ask in any language — Indonesian, English, Turkish, etc.)",
          },
        ]);
        const [input, setInput] = useState("");
        const [loading, setLoading] = useState(false);
        const messagesEndRef = useRef(null);
        const textareaRef = useRef(null);

        useEffect(() => {
          if (open) {
            messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
          }
        }, [messages, open]);

        useEffect(() => {
          if (open && textareaRef.current) {
            textareaRef.current.focus();
          }
        }, [open]);

        const serializeBlock = (block) => {
          switch (block.type) {
            case "text":
              return `${block.title ? block.title + ": " : ""}${block.text || ""}`;
            case "list":
            case "numbered":
              return `${block.title ? block.title + ":\n" : ""}${(block.items || []).map((it, i) => `  ${block.type === "numbered" ? (i + 1) + "." : "-"} ${it}`).join("\n")}`;
            case "table":
              return `${block.title ? block.title + ":\n" : ""}${(block.rows || []).map(([k, v]) => `  ${k}: ${v}`).join("\n")}`;
            case "info":
            case "note":
              return `[${block.label || block.type}] ${block.text || ""}`;
            case "vision":
              return `Vision: ${block.text || ""}`;
            case "mission":
              return `${block.title || "Mission"}:\n${(block.items || []).map((it, i) => `  ${i + 1}. ${it}`).join("\n")}`;
            case "values":
              return `${block.title || "Values"}:\n${(block.items || []).map(v => `  ${v.name} (${v.id}): ${v.desc}`).join("\n")}`;
            case "slos":
              return `${block.title || "Student Learning Outcomes"}:\n${(block.items || []).map(s => `  ${s.n}. ${s.name}: ${(s.points || []).join("; ")}`).join("\n")}`;
            case "policy":
              return [
                block.purpose ? `Purpose: ${block.purpose}` : "",
                block.scope ? `Scope: ${block.scope}` : "",
                block.examples?.length ? `Examples: ${block.examples.join(", ")}` : "",
                block.steps?.length ? `Steps:\n${block.steps.map((st, i) => `  ${i + 1}. ${st}`).join("\n")}` : "",
              ].filter(Boolean).join("\n");
            case "process":
              return `${block.title || "Process"}:\n${(block.steps || []).map(st => `  ${st.n}. ${st.title}: ${(st.actions || []).join("; ")}`).join("\n")}`;
            case "levels":
              return `${block.title || ""}:\n${(block.levels || []).map(lv => `  Level ${lv.level} - ${lv.name}: ${(lv.roles || []).map(r => r.title).join(", ")}`).join("\n")}`;
            case "roles":
              return (block.items || []).map(r => `  ${r.title}: ${(r.responsibilities || []).join("; ")}`).join("\n");
            case "evidence":
            case "compliance":
              return (block.categories || []).map(c => `  ${c.name}: ${(c.items || []).join(", ")}`).join("\n");
            case "link":
              return `Reference: ${block.text || ""} (${block.url || ""})`;
            default:
              return "";
          }
        };

        const buildSystemPrompt = () => {
          let prompt = `You are an AI assistant for the Eduversal Indonesia Academic Standards — a comprehensive 23-section framework for educational excellence developed by Yayasan Edukasi Universal Indonesia. Your role is to help school staff (teachers, administrators, managers) understand and apply these standards in their day-to-day work.

LANGUAGE: Always respond in the same language the user writes in. If they write in Indonesian (Bahasa Indonesia), respond in Indonesian. If in English, respond in English. If in Turkish, respond in Turkish.

`;
          const hasDetail = sectionsData && Object.keys(sectionsData).length > 0;

          if (hasDetail) {
            prompt += `Below is the full content of all available academic standard sections. Use this as your primary knowledge source.\n\n`;
            indexData.sections.forEach((s) => {
              const detail = sectionsData[s.id];
              prompt += `═══ SECTION ${s.id}: ${s.title.toUpperCase()} ═══\n`;
              prompt += `Keywords: ${s.tags.join(", ")} | Status: ${s.status === "complete" ? "Complete" : "Under development"}\n`;
              if (detail && detail.subsections) {
                detail.subsections.forEach((sub) => {
                  prompt += `\n  [${sub.id}] ${sub.title}\n`;
                  (sub.content || []).forEach((block) => {
                    const text = serializeBlock(block);
                    if (text.trim()) prompt += `    ${text.replace(/\n/g, "\n    ")}\n`;
                  });
                });
              } else {
                prompt += `  Description: ${s.description}\n`;
                if (s.status !== "complete") prompt += `  (Content under development)\n`;
              }
              prompt += "\n";
            });
          } else {
            prompt += `Here is the full list of the 23 academic standard sections:\n\n`;
            indexData.sections.forEach((s) => {
              prompt += `**Section ${s.id}: ${s.title}**\n`;
              prompt += `  Description: ${s.description}\n`;
              prompt += `  Keywords: ${s.tags.join(", ")}\n`;
              prompt += `  Status: ${s.status === "complete" ? "Fully documented" : "Under development"}\n\n`;
            });
          }

          prompt += `
Guidelines:
- Be specific about which section(s) cover the topic the user is asking about
- Give detailed, accurate answers based on the content above
- Be helpful, professional, and concise
- If a section is under development, mention it is still being finalized
- For sections not yet fully documented, direct users to the "Open Doc" button in the platform`;

          return prompt;
        };

        const sendMessage = async () => {
          if (!input.trim() || loading) return;

          const userMsg = { role: "user", content: input.trim() };
          const updated = [...messages, userMsg];
          setMessages(updated);
          setInput("");
          setLoading(true);

          try {
            const apiKey = window.ENV?.CLAUDE_API_KEY;
            if (!apiKey || apiKey.startsWith("__") || apiKey === "") {
              throw new Error("CLAUDE_API_KEY not configured");
            }

            const res = await fetch("https://api.anthropic.com/v1/messages", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "x-api-key": apiKey,
                "anthropic-version": "2023-06-01",
                "anthropic-dangerous-direct-browser-access": "true",
              },
              body: JSON.stringify({
                model: "claude-haiku-4-5-20251001",
                max_tokens: 1024,
                system: buildSystemPrompt(),
                messages: updated.map((m) => ({
                  role: m.role,
                  content: m.content,
                })),
              }),
            });

            if (!res.ok) {
              const errBody = await res.text();
              throw new Error(`API error ${res.status}: ${errBody}`);
            }

            const data = await res.json();
            setMessages([
              ...updated,
              { role: "assistant", content: data.content[0].text },
            ]);
          } catch (err) {
            console.error("ChatBot error:", err);
            setMessages([
              ...updated,
              {
                role: "assistant",
                content:
                  err.message.includes("CLAUDE_API_KEY not configured")
                    ? "⚠️ AI assistant is not configured. Please contact the administrator to set up the API key."
                    : "Sorry, I encountered an error. Please try again in a moment.",
              },
            ]);
          } finally {
            setLoading(false);
          }
        };

        const handleKeyDown = (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
          }
        };

        const bg = dark ? "#1f2937" : "#ffffff";
        const headerBg = dark ? "#111827" : "#0891b2";
        const msgUserBg = dark ? "#0e7490" : "#0891b2";
        const msgAsstBg = dark ? "#374151" : "#f3f4f6";
        const msgAsstColor = dark ? "#e5e7eb" : "#1c1c2e";
        const inputBg = dark ? "#374151" : "#f9fafb";
        const inputColor = dark ? "#e5e7eb" : "#1c1c2e";
        const inputBorder = dark ? "#4b5563" : "#e5e7eb";
        const borderColor = dark ? "#374151" : "#e5e7eb";
        const shadow = "0 8px 32px rgba(0,0,0,0.18)";

        return (
          <React.Fragment>
            {/* Floating Chat Button */}
            <button
              onClick={() => setOpen((v) => !v)}
              title="AI Standards Assistant"
              style={{
                position: "fixed",
                bottom: "30px",
                left: "30px",
                width: "56px",
                height: "56px",
                background: open
                  ? "linear-gradient(135deg, #0e7490, #0891b2)"
                  : "linear-gradient(135deg, #0891b2, #06b6d4)",
                borderRadius: "50%",
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                color: "white",
                border: "none",
                cursor: "pointer",
                boxShadow: "0 4px 15px rgba(8, 145, 178, 0.45)",
                zIndex: 9999,
                transition: "transform 0.2s, box-shadow 0.2s",
              }}
              onMouseEnter={(e) => {
                e.currentTarget.style.transform = "scale(1.1)";
                e.currentTarget.style.boxShadow =
                  "0 6px 20px rgba(8, 145, 178, 0.55)";
              }}
              onMouseLeave={(e) => {
                e.currentTarget.style.transform = "scale(1)";
                e.currentTarget.style.boxShadow =
                  "0 4px 15px rgba(8, 145, 178, 0.45)";
              }}
            >
              {open ? (
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
              ) : (
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
              )}
            </button>

            {/* Chat Modal */}
            {open && (
              <div
                style={{
                  position: "fixed",
                  bottom: "100px",
                  left: "30px",
                  width: "370px",
                  height: "560px",
                  background: bg,
                  borderRadius: "16px",
                  boxShadow: shadow,
                  zIndex: 10000,
                  display: "flex",
                  flexDirection: "column",
                  border: `1px solid ${borderColor}`,
                  overflow: "hidden",
                  animation: "chatSlideUp 0.22s ease-out",
                }}
              >
                {/* Header */}
                <div
                  style={{
                    background: headerBg,
                    padding: "14px 16px",
                    display: "flex",
                    alignItems: "center",
                    gap: "10px",
                    flexShrink: 0,
                  }}
                >
                  <div
                    style={{
                      width: "32px",
                      height: "32px",
                      borderRadius: "50%",
                      background: "rgba(255,255,255,0.2)",
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "center",
                      flexShrink: 0,
                    }}
                  >
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                      <circle cx="12" cy="12" r="10" />
                      <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                      <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                  </div>
                  <div style={{ flex: 1 }}>
                    <div style={{ color: "white", fontWeight: "600", fontSize: "14px", lineHeight: "1.2" }}>
                      AI Standards Assistant
                    </div>
                    <div style={{ color: "rgba(255,255,255,0.75)", fontSize: "11px" }}>
                      Powered by Claude · Eduversal Indonesia
                    </div>
                  </div>
                  <button
                    onClick={() => setOpen(false)}
                    style={{
                      background: "rgba(255,255,255,0.15)",
                      border: "none",
                      borderRadius: "6px",
                      padding: "4px 6px",
                      cursor: "pointer",
                      color: "white",
                      display: "flex",
                      alignItems: "center",
                    }}
                  >
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round">
                      <line x1="18" y1="6" x2="6" y2="18" />
                      <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                  </button>
                </div>

                {/* Messages Area */}
                <div
                  style={{
                    flex: 1,
                    overflowY: "auto",
                    padding: "16px",
                    display: "flex",
                    flexDirection: "column",
                    gap: "12px",
                  }}
                >
                  {messages.map((msg, i) => (
                    <div
                      key={i}
                      style={{
                        display: "flex",
                        justifyContent: msg.role === "user" ? "flex-end" : "flex-start",
                      }}
                    >
                      <div
                        style={{
                          maxWidth: "85%",
                          padding: "10px 14px",
                          borderRadius: msg.role === "user"
                            ? "14px 14px 4px 14px"
                            : "14px 14px 14px 4px",
                          background: msg.role === "user" ? msgUserBg : msgAsstBg,
                          color: msg.role === "user" ? "white" : msgAsstColor,
                          fontSize: "13px",
                          lineHeight: "1.55",
                          whiteSpace: "pre-wrap",
                          wordBreak: "break-word",
                        }}
                      >
                        {msg.content}
                      </div>
                    </div>
                  ))}

                  {/* Loading Indicator */}
                  {loading && (
                    <div style={{ display: "flex", justifyContent: "flex-start" }}>
                      <div
                        style={{
                          padding: "12px 16px",
                          borderRadius: "14px 14px 14px 4px",
                          background: msgAsstBg,
                          display: "flex",
                          gap: "5px",
                          alignItems: "center",
                        }}
                      >
                        {[0, 1, 2].map((d) => (
                          <span
                            key={d}
                            style={{
                              width: "7px",
                              height: "7px",
                              borderRadius: "50%",
                              background: dark ? "#9ca3af" : "#9ca3af",
                              display: "inline-block",
                              animation: `chatDot 1.2s ${d * 0.2}s infinite ease-in-out`,
                            }}
                          />
                        ))}
                      </div>
                    </div>
                  )}
                  <div ref={messagesEndRef} />
                </div>

                {/* Input Area */}
                <div
                  style={{
                    padding: "12px 14px",
                    borderTop: `1px solid ${borderColor}`,
                    display: "flex",
                    gap: "8px",
                    alignItems: "flex-end",
                    flexShrink: 0,
                  }}
                >
                  <textarea
                    ref={textareaRef}
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    onKeyDown={handleKeyDown}
                    placeholder="Ask about any academic standard..."
                    rows={1}
                    style={{
                      flex: 1,
                      background: inputBg,
                      color: inputColor,
                      border: `1px solid ${inputBorder}`,
                      borderRadius: "10px",
                      padding: "9px 12px",
                      fontSize: "13px",
                      resize: "none",
                      outline: "none",
                      fontFamily: "inherit",
                      lineHeight: "1.5",
                      maxHeight: "90px",
                      overflowY: "auto",
                    }}
                    onInput={(e) => {
                      e.target.style.height = "auto";
                      e.target.style.height = Math.min(e.target.scrollHeight, 90) + "px";
                    }}
                  />
                  <button
                    onClick={sendMessage}
                    disabled={!input.trim() || loading}
                    style={{
                      width: "36px",
                      height: "36px",
                      borderRadius: "10px",
                      background:
                        !input.trim() || loading
                          ? (dark ? "#374151" : "#e5e7eb")
                          : "#0891b2",
                      border: "none",
                      cursor: !input.trim() || loading ? "not-allowed" : "pointer",
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "center",
                      flexShrink: 0,
                      transition: "background 0.15s",
                    }}
                  >
                    <svg
                      viewBox="0 0 24 24"
                      width="16"
                      height="16"
                      fill="none"
                      stroke={!input.trim() || loading ? (dark ? "#6b7280" : "#9ca3af") : "white"}
                      strokeWidth="2.2"
                      strokeLinecap="round"
                      strokeLinejoin="round"
                    >
                      <line x1="22" y1="2" x2="11" y2="13" />
                      <polygon points="22 2 15 22 11 13 2 9 22 2" />
                    </svg>
                  </button>
                </div>
              </div>
            )}

            {/* Keyframe animations */}
            <style>{`
              @keyframes chatSlideUp {
                from { opacity: 0; transform: translateY(12px) scale(0.97); }
                to   { opacity: 1; transform: translateY(0)   scale(1);    }
              }
              @keyframes chatDot {
                0%, 80%, 100% { transform: scale(0.7); opacity: 0.5; }
                40%           { transform: scale(1.1); opacity: 1;   }
              }
            `}</style>
          </React.Fragment>
        );
      };

      ReactDOM.render(<App />, document.getElementById("root"));
    </script>

    <!-- Floating Home Button -->
    <a
      href="index.html"
      style="
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 56px;
        height: 56px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-decoration: none;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        z-index: 9999;
      "
    >
      <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
      </svg>
    </a>
  </body>
</html>

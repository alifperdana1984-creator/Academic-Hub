<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Eduversal Indonesia Academic Calendar ‚Äì interactive yearly activity timeline for partner schools" />
    <meta name="theme-color" content="#667eea" />
    <title>Academic Calendar | Eduversal Indonesia</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;charset=utf-8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%230a0a1a'/><polygon points='10,45 50,65 50,70 10,50' fill='%234e3db8'/><polygon points='90,45 50,65 50,70 90,50' fill='%235a4bd1'/><polygon points='50,25 90,45 50,65 10,45' fill='%236c5ce7'/><line x1='85' y1='46' x2='85' y2='68' stroke='%23ffd93d' stroke-width='4' stroke-linecap='round'/><circle cx='85' cy='72' r='3.5' fill='%23ffd93d'/></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <style>
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --glass-bg: rgba(255,255,255,0.08);
        --glass-border: rgba(255,255,255,0.12);
        --text-primary: #ffffff;
        --text-secondary: rgba(255,255,255,0.7);
        --card-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        --week-width: 130px;
        --label-width: 210px;
      }
      * { margin:0; padding:0; box-sizing:border-box; }
      body { font-family:"DM Sans",sans-serif; background:linear-gradient(135deg,#0c0c0c 0%,#1a1a2e 100%); min-height:100vh; color:#fff; overflow-x:hidden; }

      /* ‚îÄ‚îÄ Background ‚îÄ‚îÄ */
      .bg-animation { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; overflow:hidden; }
      .bg-animation::before { content:""; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background: radial-gradient(ellipse at 20% 80%,rgba(120,119,198,.15) 0%,transparent 50%), radial-gradient(ellipse at 80% 20%,rgba(255,119,198,.10) 0%,transparent 50%), radial-gradient(ellipse at 40% 40%,rgba(79,172,254,.08) 0%,transparent 50%); animation:bgFloat 20s ease-in-out infinite; }
      @keyframes bgFloat { 0%,100%{transform:translate(0,0) rotate(0deg);} 33%{transform:translate(30px,-30px) rotate(1deg);} 66%{transform:translate(-20px,20px) rotate(-1deg);} }
      .orb { position:fixed; border-radius:50%; filter:blur(80px); opacity:.35; animation:orbFloat 15s ease-in-out infinite; pointer-events:none; }
      .orb-1 { width:400px; height:400px; background:linear-gradient(135deg,#667eea,#764ba2); top:-100px; right:-100px; animation-delay:0s; }
      .orb-2 { width:300px; height:300px; background:linear-gradient(135deg,#f093fb,#f5576c); bottom:-50px; left:-50px; animation-delay:-5s; }
      .orb-3 { width:250px; height:250px; background:linear-gradient(135deg,#4facfe,#00f2fe); top:40%; left:60%; animation-delay:-10s; }
      @keyframes orbFloat { 0%,100%{transform:translate(0,0) scale(1);} 50%{transform:translate(50px,-50px) scale(1.1);} }

      /* ‚îÄ‚îÄ Top Nav ‚îÄ‚îÄ */
      .top-nav { position:fixed; top:0; left:0; right:0; z-index:1000; display:flex; align-items:center; justify-content:space-between; padding:0 28px; height:62px; background:rgba(5,5,16,.80); backdrop-filter:blur(20px); border-bottom:1px solid rgba(255,255,255,.08); gap:16px; transition:background .3s,padding .3s,height .3s; }
      .top-nav.scrolled { background:rgba(5,5,16,.95); height:54px; }
      .nav-brand { display:flex; align-items:center; gap:10px; text-decoration:none; flex-shrink:0; }
      .nav-brand-icon { width:32px; height:32px; flex-shrink:0; }
      .nav-brand-icon svg { width:32px; height:32px; fill:#6c5ce7; }
      .nav-brand-name { font-family:"Playfair Display",serif; font-size:15px; font-weight:700; color:#fff; white-space:nowrap; }
      .nav-stats { display:flex; align-items:center; gap:28px; flex-shrink:0; }
      .nav-stat { display:flex; flex-direction:column; align-items:center; line-height:1; }
      .nav-stat-value { font-size:16px; font-weight:700; color:#fff; }
      .nav-stat-label { font-size:10px; font-weight:500; color:rgba(255,255,255,.45); text-transform:uppercase; letter-spacing:.04em; margin-top:2px; }
      .nav-stat-divider { width:1px; height:28px; background:rgba(255,255,255,.1); }
      .nav-actions { display:flex; align-items:center; gap:8px; flex-shrink:0; }
      .nav-btn { display:flex; align-items:center; gap:7px; padding:9px 18px; border-radius:10px; background:linear-gradient(135deg,rgba(108,92,231,.20),rgba(0,217,255,.10)); border:1px solid rgba(108,92,231,.45); color:rgba(255,255,255,.85); font-family:"DM Sans",sans-serif; font-size:13px; font-weight:500; cursor:pointer; text-decoration:none; transition:all .22s ease; position:relative; white-space:nowrap; }
      .nav-btn svg { width:15px; height:15px; flex-shrink:0; }
      .nav-btn:hover,.nav-btn.active { background:linear-gradient(135deg,rgba(108,92,231,.45),rgba(0,217,255,.25)); border-color:rgba(108,92,231,.7); color:#fff; box-shadow:0 0 16px rgba(108,92,231,.40); transform:translateY(-1px); }
      .nav-btn.active { box-shadow:0 0 16px rgba(108,92,231,.50); }
      .nav-badge { position:absolute; top:5px; right:5px; min-width:17px; height:17px; padding:0 4px; background:#e74c3c; border-radius:50%; font-size:10px; font-weight:700; color:#fff; line-height:17px; text-align:center; display:none; }
      .nav-badge.visible { display:flex; align-items:center; justify-content:center; }
      /* Profile */
      .profile-wrap { position:relative; }
      .profile-btn { display:flex; align-items:center; gap:8px; padding:6px 12px 6px 6px; border-radius:100px; background:linear-gradient(135deg,rgba(108,92,231,.20),rgba(0,217,255,.10)); border:1px solid rgba(108,92,231,.45); cursor:pointer; transition:all .22s; }
      .profile-btn:hover { background:linear-gradient(135deg,rgba(108,92,231,.35),rgba(0,217,255,.20)); box-shadow:0 0 16px rgba(108,92,231,.35); }
      .profile-avatar { width:30px; height:30px; border-radius:50%; background:var(--primary-gradient); display:flex; align-items:center; justify-content:center; font-size:13px; font-weight:700; color:#fff; }
      .profile-first-name { font-size:13px; font-weight:500; color:#fff; }
      .profile-chevron { width:14px; height:14px; color:rgba(255,255,255,.6); transition:transform .2s; }
      .profile-wrap.open .profile-chevron { transform:rotate(180deg); }
      .profile-dropdown { position:absolute; top:calc(100% + 8px); right:0; width:280px; background:rgba(15,15,35,.98); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:8px; box-shadow:0 20px 60px rgba(0,0,0,.6); display:none; z-index:100; }
      .profile-wrap.open .profile-dropdown { display:block; animation:dropIn .2s ease; }
      @keyframes dropIn { from{opacity:0;transform:translateY(-8px);} to{opacity:1;transform:translateY(0);} }
      .dd-header { display:flex; align-items:center; gap:12px; padding:12px; border-radius:10px; background:rgba(255,255,255,.05); margin-bottom:8px; }
      .dd-avatar { width:44px; height:44px; border-radius:50%; background:var(--primary-gradient); display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:700; color:#fff; flex-shrink:0; }
      .dd-name { font-size:14px; font-weight:600; color:#fff; }
      .dd-email { font-size:12px; color:rgba(255,255,255,.5); margin-top:2px; }
      .dd-section { padding:8px 4px; }
      .dd-section-label { font-size:11px; color:rgba(255,255,255,.4); text-transform:uppercase; letter-spacing:.05em; margin-bottom:6px; }
      .dd-input { width:100%; padding:8px 12px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); border-radius:8px; color:#fff; font-family:"DM Sans",sans-serif; font-size:13px; outline:none; }
      .dd-input:focus { border-color:rgba(108,92,231,.6); }
      .dd-phone-row { display:flex; gap:8px; }
      .dd-save-btn { padding:8px 16px; border-radius:8px; background:linear-gradient(135deg,#667eea,#764ba2); border:none; color:#fff; font-size:13px; font-weight:600; cursor:pointer; white-space:nowrap; }
      .dd-status { font-size:12px; color:#10b981; margin-top:4px; min-height:16px; }
      .dd-pw-toggle { width:100%; display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10); border-radius:8px; color:rgba(255,255,255,.8); font-size:13px; cursor:pointer; }
      .dd-pw-toggle svg { width:14px; height:14px; transition:transform .2s; }
      .dd-pw-fields { display:none; flex-direction:column; gap:6px; margin-top:8px; }
      .dd-pw-btn { padding:8px; border-radius:8px; background:linear-gradient(135deg,#667eea,#764ba2); border:none; color:#fff; font-size:13px; font-weight:600; cursor:pointer; }
      .dd-signout-btn { width:100%; display:flex; align-items:center; gap:8px; padding:10px 12px; background:rgba(239,68,68,.12); border:1px solid rgba(239,68,68,.25); border-radius:8px; color:#ef4444; font-size:13px; cursor:pointer; transition:all .2s; }
      .dd-signout-btn svg { width:15px; height:15px; }
      .dd-signout-btn:hover { background:rgba(239,68,68,.22); }
      @media(max-width:768px){ .top-nav{padding:0 16px;} .nav-btn span{display:none;} .nav-btn{padding:9px; border-radius:10px;} .nav-stats{display:none;} .nav-brand-name{display:none;} }

      /* ‚îÄ‚îÄ Page Header ‚îÄ‚îÄ */
      .page-header { padding: 5.5rem 2rem 1.5rem; position:relative; z-index:10; }
      .back-link { display:inline-flex; align-items:center; gap:6px; color:rgba(255,255,255,.55); font-size:13px; text-decoration:none; margin-bottom:1rem; transition:color .2s; }
      .back-link:hover { color:#fff; }
      .back-link svg { width:14px; height:14px; }
      .page-header h1 { font-family:"Playfair Display",serif; font-size:clamp(2rem,4vw,3.5rem); font-weight:700; background:linear-gradient(135deg,#fff 0%,#e0e7ff 50%,#c7d2fe 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:.5rem; }
      .page-header .subtitle { font-size:1rem; color:rgba(255,255,255,.6); }
      @keyframes pulse { 0%,100%{opacity:1;transform:scale(1);} 50%{opacity:.5;transform:scale(1.2);} }

      /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
      main { max-width:1700px; margin:0 auto; padding:0 2rem 4rem; position:relative; z-index:10; }

      /* ‚îÄ‚îÄ Stats Bar ‚îÄ‚îÄ */
      .stats-bar { display:grid; grid-template-columns:repeat(4,1fr); gap:1rem; margin-bottom:1.5rem; }
      .stat-card { background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10); border-radius:16px; padding:1.2rem 1.4rem; display:flex; align-items:center; gap:14px; transition:all .3s; }
      .stat-card:hover { background:rgba(255,255,255,.09); border-color:rgba(255,255,255,.16); }
      .stat-icon { width:44px; height:44px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; }
      .stat-text { flex:1; min-width:0; }
      .stat-value { font-size:1.6rem; font-weight:700; color:#fff; line-height:1; }
      .stat-label { font-size:12px; color:rgba(255,255,255,.5); margin-top:3px; }
      @media(max-width:900px){ .stats-bar{grid-template-columns:repeat(2,1fr);} }
      @media(max-width:500px){ .stats-bar{grid-template-columns:1fr;} }

      /* ‚îÄ‚îÄ Filter Bar ‚îÄ‚îÄ */
      .filter-bar { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:1.25rem; flex-wrap:wrap; }
      .filter-cats { display:flex; gap:8px; flex-wrap:wrap; }
      .filter-btn { padding:7px 14px; border-radius:20px; border:1px solid rgba(255,255,255,.15); background:rgba(255,255,255,.07); color:rgba(255,255,255,.7); font-size:13px; font-weight:500; cursor:pointer; transition:all .2s; white-space:nowrap; }
      .filter-btn:hover { background:rgba(255,255,255,.12); color:#fff; }
      .filter-btn.active { color:#fff; border-color:transparent; }
      .filter-right { display:flex; gap:10px; align-items:center; }
      .search-input { padding:8px 14px; border-radius:10px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); color:#fff; font-family:"DM Sans",sans-serif; font-size:13px; outline:none; width:200px; transition:all .2s; }
      .search-input::placeholder { color:rgba(255,255,255,.35); }
      .search-input:focus { border-color:rgba(108,92,231,.6); background:rgba(255,255,255,.11); }
      .add-btn { display:none; align-items:center; gap:7px; padding:9px 18px; border-radius:10px; background:linear-gradient(135deg,#667eea,#764ba2); border:none; color:#fff; font-size:13px; font-weight:600; cursor:pointer; transition:all .22s; white-space:nowrap; }
      .add-btn:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(102,126,234,.45); }
      .add-btn svg { width:15px; height:15px; }

      /* ‚îÄ‚îÄ Timeline Outer ‚îÄ‚îÄ */
      .timeline-outer { overflow-x:auto; border-radius:16px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.25); margin-bottom:1.5rem; }
      .timeline-table { display:flex; flex-direction:column; min-width:max-content; }

      /* Month row */
      .tl-month-row { display:flex; border-bottom:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.3); position:sticky; top:0; z-index:15; }
      .tl-corner { width:var(--label-width); flex-shrink:0; padding:12px 16px; font-size:11px; font-weight:600; color:rgba(255,255,255,.4); text-transform:uppercase; letter-spacing:.06em; border-right:1px solid rgba(255,255,255,.08); display:flex; align-items:center; position:sticky; left:0; z-index:20; background:rgba(5,5,20,.98); }
      .tl-month-cell { display:flex; align-items:center; justify-content:center; border-right:1px solid rgba(255,255,255,.08); font-size:13px; font-weight:700; color:rgba(255,255,255,.85); padding:10px 0; letter-spacing:.02em; }
      .tl-month-cell.current-month { color:#4facfe; }

      /* Week row */
      .tl-week-row { display:flex; border-bottom:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.2); position:sticky; top:41px; z-index:14; }
      .tl-corner-2 { width:var(--label-width); flex-shrink:0; border-right:1px solid rgba(255,255,255,.08); position:sticky; left:0; z-index:20; background:rgba(5,5,20,.98); }
      .tl-week-cell { width:var(--week-width); flex-shrink:0; text-align:center; padding:5px 0; font-size:11px; font-weight:500; color:rgba(255,255,255,.35); border-right:1px solid rgba(255,255,255,.05); }
      .tl-week-cell.current-week { color:#4facfe; font-weight:700; background:rgba(79,172,254,.07); }

      /* Lane rows */
      .tl-lane-row { display:flex; border-bottom:1px solid rgba(255,255,255,.06); min-height:70px; transition:min-height .3s; }
      .tl-lane-row:last-child { border-bottom:none; }
      .tl-label { width:var(--label-width); flex-shrink:0; padding:0 16px; display:flex; align-items:flex-start; justify-content:flex-start; flex-direction:column; gap:2px; border-right:1px solid rgba(255,255,255,.08); position:sticky; left:0; z-index:10; background:rgba(8,8,22,.97); padding-top:14px; cursor:pointer; transition:background .2s; }
      .tl-label:hover { background:rgba(15,15,35,.99); }
      .tl-label.hidden-lane { opacity:.35; }
      .tl-label-icon { font-size:16px; line-height:1; }
      .tl-label-text { font-size:12px; font-weight:600; color:rgba(255,255,255,.85); }
      .tl-label-sub { font-size:10px; color:rgba(255,255,255,.4); }
      .tl-label-count { display:inline-flex; align-items:center; justify-content:center; min-width:18px; height:18px; border-radius:9px; font-size:10px; font-weight:700; color:#fff; padding:0 5px; margin-top:4px; }
      .tl-bar-area { flex:1; position:relative; background-image:repeating-linear-gradient(90deg,transparent,transparent calc(var(--week-width) - 1px),rgba(255,255,255,.04) calc(var(--week-width) - 1px),rgba(255,255,255,.04) var(--week-width)); background-size:var(--week-width) 100%; }

      /* Month dividers in bar area */
      .month-div { position:absolute; top:0; bottom:0; width:1px; background:rgba(255,255,255,.10); z-index:2; pointer-events:none; }
      .month-div-label { position:absolute; top:4px; left:4px; font-size:9px; color:rgba(255,255,255,.18); font-weight:600; text-transform:uppercase; letter-spacing:.05em; }

      /* Activity bars */
      .act-bar { position:absolute; height:34px; border-radius:8px; display:flex; align-items:center; padding:0 10px; gap:6px; cursor:pointer; transition:transform .18s, box-shadow .18s, filter .18s; z-index:3; overflow:hidden; white-space:nowrap; }
      .act-bar:hover { transform:translateY(-2px) scaleY(1.04); z-index:5; }
      .act-bar::before { content:""; position:absolute; inset:0; background:rgba(255,255,255,0); transition:background .18s; border-radius:8px; }
      .act-bar:hover::before { background:rgba(255,255,255,.08); }
      .act-bar-priority { width:5px; height:5px; border-radius:50%; flex-shrink:0; }
      .act-bar-title { font-size:11.5px; font-weight:600; color:#fff; overflow:hidden; text-overflow:ellipsis; flex:1; min-width:0; text-shadow:0 1px 3px rgba(0,0,0,.4); }
      .act-bar-weeks { font-size:10px; color:rgba(255,255,255,.6); flex-shrink:0; }

      /* Today line */
      .today-line { position:absolute; top:0; bottom:0; width:2px; background:linear-gradient(180deg,#ff6b6b,rgba(255,107,107,.3)); z-index:8; pointer-events:none; }
      .today-label { position:absolute; top:-22px; left:50%; transform:translateX(-50%); background:#ff6b6b; color:#fff; font-size:9px; font-weight:700; padding:2px 6px; border-radius:4px; white-space:nowrap; }
      .today-dot { position:absolute; top:-4px; left:50%; transform:translateX(-50%); width:8px; height:8px; border-radius:50%; background:#ff6b6b; border:2px solid #fff; }
      .today-line-inner { position:relative; width:2px; height:100%; background:linear-gradient(180deg,rgba(255,107,107,.9) 0%,rgba(255,107,107,.25) 100%); }

      /* ‚îÄ‚îÄ Legend ‚îÄ‚îÄ */
      .legend { display:flex; gap:20px; flex-wrap:wrap; padding:1rem 1.25rem; background:rgba(255,255,255,.04); border-radius:12px; border:1px solid rgba(255,255,255,.08); margin-bottom:2rem; }
      .legend-item { display:flex; align-items:center; gap:7px; font-size:12px; color:rgba(255,255,255,.6); }
      .legend-dot { width:10px; height:10px; border-radius:3px; flex-shrink:0; }

      /* ‚îÄ‚îÄ Modals ‚îÄ‚îÄ */
      .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.65); z-index:2000; display:none; align-items:center; justify-content:center; padding:20px; backdrop-filter:blur(4px); }
      .modal-overlay.open { display:flex; animation:fadeIn .2s ease; }
      @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
      .modal-box { background:rgba(15,15,35,.98); border:1px solid rgba(255,255,255,.14); border-radius:24px; width:100%; max-width:640px; max-height:90vh; overflow-y:auto; box-shadow:0 40px 100px rgba(0,0,0,.7); animation:slideUp .25s ease; }
      @keyframes slideUp { from{opacity:0;transform:translateY(24px);} to{opacity:1;transform:translateY(0);} }
      .modal-box::-webkit-scrollbar { width:4px; }
      .modal-box::-webkit-scrollbar-track { background:transparent; }
      .modal-box::-webkit-scrollbar-thumb { background:rgba(255,255,255,.15); border-radius:2px; }
      .modal-header { padding:24px 28px 20px; border-bottom:1px solid rgba(255,255,255,.08); position:sticky; top:0; background:rgba(15,15,35,.98); z-index:5; border-radius:24px 24px 0 0; }
      .modal-header-top { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:10px; }
      .modal-title { font-family:"Playfair Display",serif; font-size:1.35rem; font-weight:700; color:#fff; line-height:1.3; }
      .modal-close { width:32px; height:32px; border-radius:8px; background:rgba(255,255,255,.08); border:none; color:rgba(255,255,255,.6); cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:all .18s; }
      .modal-close:hover { background:rgba(255,255,255,.14); color:#fff; }
      .modal-close svg { width:16px; height:16px; }
      .modal-badges { display:flex; gap:8px; flex-wrap:wrap; }
      .badge { display:inline-flex; align-items:center; gap:5px; padding:4px 10px; border-radius:20px; font-size:11px; font-weight:600; }
      .badge-priority-high   { background:rgba(239,68,68,.18); color:#ef4444; border:1px solid rgba(239,68,68,.35); }
      .badge-priority-medium { background:rgba(245,158,11,.18); color:#f59e0b; border:1px solid rgba(245,158,11,.35); }
      .badge-priority-low    { background:rgba(16,185,129,.18); color:#10b981; border:1px solid rgba(16,185,129,.35); }
      .modal-body { padding:24px 28px; display:flex; flex-direction:column; gap:20px; }
      .modal-section-title { font-size:11px; font-weight:600; color:rgba(255,255,255,.4); text-transform:uppercase; letter-spacing:.06em; margin-bottom:8px; }
      .modal-info-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
      .modal-info-item { background:rgba(255,255,255,.05); border-radius:10px; padding:12px 14px; }
      .modal-info-label { font-size:11px; color:rgba(255,255,255,.4); margin-bottom:3px; }
      .modal-info-value { font-size:14px; font-weight:600; color:#fff; }
      .modal-description { font-size:14px; color:rgba(255,255,255,.75); line-height:1.7; background:rgba(255,255,255,.04); border-radius:10px; padding:14px; }
      /* Documents */
      .doc-list { display:flex; flex-direction:column; gap:8px; }
      .doc-item { display:flex; align-items:center; gap:10px; padding:10px 14px; border-radius:10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.09); text-decoration:none; color:#fff; transition:all .18s; cursor:pointer; }
      .doc-item:hover { background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.16); transform:translateX(3px); }
      .doc-icon { width:32px; height:32px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; }
      .doc-icon-pdf  { background:rgba(239,68,68,.2); }
      .doc-icon-xlsx { background:rgba(16,185,129,.2); }
      .doc-icon-docx { background:rgba(79,172,254,.2); }
      .doc-icon-link { background:rgba(168,85,247,.2); }
      .doc-icon-folder{ background:rgba(245,158,11,.2); }
      .doc-name { font-size:13px; font-weight:500; }
      .doc-type { font-size:11px; color:rgba(255,255,255,.4); text-transform:uppercase; }
      /* Completion */
      .completion-bar-wrap { background:rgba(255,255,255,.06); border-radius:10px; padding:14px; }
      .completion-bar-label { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; font-size:13px; color:rgba(255,255,255,.8); }
      .completion-bar-track { height:8px; background:rgba(255,255,255,.10); border-radius:4px; overflow:hidden; }
      .completion-bar-fill { height:100%; border-radius:4px; background:linear-gradient(90deg,#11998e,#38ef7d); transition:width .6s ease; }
      .school-completions { display:flex; flex-direction:column; gap:4px; max-height:180px; overflow-y:auto; margin-top:10px; }
      .school-comp-row { display:flex; align-items:center; gap:8px; padding:5px 8px; border-radius:6px; }
      .school-comp-row:hover { background:rgba(255,255,255,.04); }
      .school-comp-check { width:16px; height:16px; border-radius:4px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
      .school-comp-check.done { background:#10b981; }
      .school-comp-check.pending { background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.2); }
      .school-comp-check svg { width:10px; height:10px; color:#fff; }
      .school-comp-name { font-size:12px; color:rgba(255,255,255,.75); flex:1; }
      .school-comp-date { font-size:10px; color:rgba(255,255,255,.35); }
      /* My completion */
      .my-completion { background:rgba(255,255,255,.06); border-radius:10px; padding:14px; }
      .my-comp-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
      .my-comp-label { font-size:13px; font-weight:600; color:#fff; }
      .toggle-btn { display:flex; align-items:center; gap:8px; padding:7px 16px; border-radius:8px; border:none; font-size:13px; font-weight:600; cursor:pointer; transition:all .2s; }
      .toggle-btn.completed { background:linear-gradient(135deg,#11998e,#38ef7d); color:#fff; }
      .toggle-btn.pending { background:rgba(255,255,255,.10); color:rgba(255,255,255,.8); border:1px solid rgba(255,255,255,.18); }
      .toggle-btn svg { width:14px; height:14px; }
      .notes-area { width:100%; padding:10px 12px; background:rgba(255,255,255,.07); border:1px solid rgba(255,255,255,.12); border-radius:8px; color:#fff; font-family:"DM Sans",sans-serif; font-size:13px; resize:vertical; min-height:70px; outline:none; transition:border .2s; }
      .notes-area:focus { border-color:rgba(108,92,231,.55); }
      /* Modal footer */
      .modal-footer { padding:16px 28px 24px; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; }
      .btn { display:inline-flex; align-items:center; gap:7px; padding:9px 20px; border-radius:10px; font-size:13px; font-weight:600; cursor:pointer; transition:all .2s; border:none; }
      .btn svg { width:15px; height:15px; }
      .btn-primary { background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; }
      .btn-primary:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(102,126,234,.4); }
      .btn-danger { background:rgba(239,68,68,.15); color:#ef4444; border:1px solid rgba(239,68,68,.3); }
      .btn-danger:hover { background:rgba(239,68,68,.25); }
      .btn-ghost { background:rgba(255,255,255,.08); color:rgba(255,255,255,.8); border:1px solid rgba(255,255,255,.12); }
      .btn-ghost:hover { background:rgba(255,255,255,.14); color:#fff; }
      .btn-success { background:linear-gradient(135deg,#11998e,#38ef7d); color:#fff; }
      .btn-success:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(17,153,142,.4); }

      /* ‚îÄ‚îÄ Form Modal ‚îÄ‚îÄ */
      .modal-form .modal-box { max-width:700px; }
      .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
      .form-group { display:flex; flex-direction:column; gap:6px; }
      .form-group.full { grid-column:1/-1; }
      .form-label { font-size:12px; font-weight:600; color:rgba(255,255,255,.55); text-transform:uppercase; letter-spacing:.04em; }
      .form-input, .form-select, .form-textarea { padding:10px 14px; border-radius:10px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); color:#fff; font-family:"DM Sans",sans-serif; font-size:13px; outline:none; transition:all .2s; }
      .form-input:focus, .form-select:focus, .form-textarea:focus { border-color:rgba(108,92,231,.6); background:rgba(255,255,255,.11); }
      .form-select option { background:#1a1a35; color:#fff; }
      .form-textarea { resize:vertical; min-height:90px; }
      .doc-list-form { display:flex; flex-direction:column; gap:8px; }
      .doc-form-row { display:grid; grid-template-columns:1fr auto 80px 32px; gap:8px; align-items:center; }
      .doc-form-row .form-input { padding:8px 10px; }
      .doc-form-row .form-select { padding:8px 10px; }
      .doc-remove-btn { width:32px; height:32px; border-radius:8px; background:rgba(239,68,68,.15); border:1px solid rgba(239,68,68,.25); color:#ef4444; cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
      .doc-remove-btn svg { width:14px; height:14px; }
      .add-doc-btn { display:inline-flex; align-items:center; gap:6px; padding:7px 14px; border-radius:8px; background:rgba(255,255,255,.07); border:1px solid rgba(255,255,255,.12); color:rgba(255,255,255,.7); font-size:12px; cursor:pointer; transition:all .2s; }
      .add-doc-btn:hover { background:rgba(255,255,255,.12); color:#fff; }
      .schools-select-wrap { display:flex; flex-direction:column; gap:6px; }
      .schools-toggle { display:flex; gap:8px; margin-bottom:4px; }
      .schools-toggle-btn { padding:5px 12px; border-radius:20px; border:1px solid rgba(255,255,255,.15); background:rgba(255,255,255,.07); color:rgba(255,255,255,.6); font-size:12px; cursor:pointer; transition:all .18s; }
      .schools-toggle-btn.active { background:rgba(102,126,234,.25); border-color:rgba(102,126,234,.5); color:#fff; }

      /* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
      .loading-overlay { position:fixed; inset:0; background:rgba(0,0,0,.65); z-index:9999; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:16px; }
      .spinner { width:44px; height:44px; border:3px solid rgba(255,255,255,.12); border-top-color:#667eea; border-radius:50%; animation:spin 0.9s linear infinite; }
      @keyframes spin { to{ transform:rotate(360deg); } }
      .loading-text { font-size:14px; color:rgba(255,255,255,.6); }

      /* ‚îÄ‚îÄ Empty state ‚îÄ‚îÄ */
      .empty-lane { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:12px; color:rgba(255,255,255,.18); font-style:italic; }

      /* Scrollbar */
      .timeline-outer::-webkit-scrollbar { height:6px; }
      .timeline-outer::-webkit-scrollbar-track { background:rgba(255,255,255,.04); border-radius:3px; }
      .timeline-outer::-webkit-scrollbar-thumb { background:rgba(255,255,255,.18); border-radius:3px; }
      .timeline-outer::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,.28); }

      /* Scroll-to-today btn */
      .today-btn { position:fixed; bottom:28px; right:28px; display:flex; align-items:center; gap:7px; padding:10px 18px; border-radius:12px; background:linear-gradient(135deg,rgba(79,172,254,.9),rgba(0,242,254,.8)); border:none; color:#fff; font-size:13px; font-weight:600; cursor:pointer; box-shadow:0 8px 32px rgba(79,172,254,.4); transition:all .22s; z-index:100; }
      .today-btn:hover { transform:translateY(-2px); box-shadow:0 12px 40px rgba(79,172,254,.55); }
      .today-btn svg { width:15px; height:15px; }
    </style>
  </head>

  <body>
    <div class="bg-animation"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <!-- ‚ïê‚ïê TOP NAV ‚ïê‚ïê -->
    <nav class="top-nav" id="topNav">
      <a href="index.html" class="nav-brand">
        <div class="nav-brand-icon">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zM5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"/>
          </svg>
        </div>
        <span class="nav-brand-name">Eduversal Indonesia</span>
      </a>
      <div class="nav-stats">
        <div class="nav-stat"><span class="nav-stat-value">15</span><span class="nav-stat-label">Partner Schools</span></div>
        <div class="nav-stat-divider"></div>
        <div class="nav-stat"><span class="nav-stat-value">2025/26</span><span class="nav-stat-label">Academic Year</span></div>
      </div>
      <div class="nav-actions">
        <a href="AcademicCalendar.html" class="nav-btn active">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          <span>Calendar</span>
        </a>
        <a href="announcements.html" class="nav-btn" id="navAnnBtn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 3L9.218 10.083M11.698 20.334C12.573 21.209 14 20.561 14 19.307V4.693C14 3.439 12.573 2.791 11.698 3.666L7 8H4C2.895 8 2 8.895 2 10v4c0 1.105.895 2 2 2h3l4.698 4.334z"/></svg>
          <span>Announcements</span>
          <span class="nav-badge" id="annBadge"></span>
        </a>
        <a href="messageboard.html" class="nav-btn" id="navMsgBtn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
          <span>Message Board</span>
          <span class="nav-badge" id="msgBadge"></span>
        </a>
        <a href="library.html" class="nav-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
          <span>Library</span>
        </a>
        <div class="profile-wrap" id="profileWrap" style="display:none;">
          <button class="profile-btn" id="profileBtn">
            <div class="profile-avatar" id="navAvatar"></div>
            <span class="profile-first-name" id="navFirstName"></span>
            <svg class="profile-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
          <div class="profile-dropdown" id="profileDropdown">
            <div class="dd-header">
              <div class="dd-avatar" id="ddAvatar"></div>
              <div><div class="dd-name" id="ddFullName"></div><div class="dd-email" id="ddEmail"></div></div>
            </div>
            <div class="dd-section">
              <div class="dd-section-label">Phone Number</div>
              <div class="dd-phone-row">
                <input type="tel" class="dd-input" id="ddPhone" placeholder="+62 xxx-xxxx-xxxx">
                <button class="dd-save-btn" id="ddSavePhone">Save</button>
              </div>
              <div class="dd-status" id="ddPhoneStatus"></div>
            </div>
            <div class="dd-section" id="ddPwSection" style="display:none;">
              <button class="dd-pw-toggle" id="ddPwToggle">Change Password<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button>
              <div class="dd-pw-fields" id="ddPwFields">
                <input type="password" class="dd-input" id="ddCurrentPw" placeholder="Current password">
                <input type="password" class="dd-input" id="ddNewPw" placeholder="New password (min 6 chars)">
                <input type="password" class="dd-input" id="ddConfirmPw" placeholder="Confirm new password">
                <button class="dd-pw-btn" id="ddUpdatePwBtn">Update Password</button>
                <div class="dd-status" id="ddPwStatus"></div>
              </div>
            </div>
            <div class="dd-section">
              <button class="dd-signout-btn" id="ddSignOut">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/></svg>
                Sign Out
              </button>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- ‚ïê‚ïê PAGE HEADER ‚ïê‚ïê -->
    <div class="page-header">
      <a href="index.html" class="back-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        Dashboard
      </a>
      <h1>üìÖ Academic Calendar</h1>
      <p class="subtitle">2025/26 Annual Activity Timeline ¬∑ July 2025 ‚Äì May 2026</p>
    </div>

    <main>
      <!-- ‚ïê‚ïê STATS BAR ‚ïê‚ïê -->
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-icon" style="background:rgba(102,126,234,.18);">üìä</div>
          <div class="stat-text"><div class="stat-value" id="statTotal">‚Äî</div><div class="stat-label">Total Activities</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:rgba(16,185,129,.18);">‚úÖ</div>
          <div class="stat-text"><div class="stat-value" id="statCompleted">‚Äî</div><div class="stat-label">Completed</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:rgba(79,172,254,.18);">üìÖ</div>
          <div class="stat-text"><div class="stat-value" id="statThisMonth">‚Äî</div><div class="stat-label">This Month</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:rgba(245,158,11,.18);">‚è≥</div>
          <div class="stat-text"><div class="stat-value" id="statUpcoming">‚Äî</div><div class="stat-label">Upcoming (30 days)</div></div>
        </div>
      </div>

      <!-- ‚ïê‚ïê FILTER BAR ‚ïê‚ïê -->
      <div class="filter-bar">
        <div class="filter-cats" id="filterCats">
          <button class="filter-btn active" data-cat="all" style="border-color:rgba(108,92,231,.4); background:rgba(108,92,231,.18); color:#fff;">üîç All</button>
          <button class="filter-btn" data-cat="assessment">üìä Assessment</button>
          <button class="filter-btn" data-cat="training">üéì Training &amp; PD</button>
          <button class="filter-btn" data-cat="visit">üè´ School Visit</button>
          <button class="filter-btn" data-cat="report">üìã Reporting</button>
          <button class="filter-btn" data-cat="event">üéâ Events</button>
          <button class="filter-btn" data-cat="parent">üë®‚Äçüë©‚Äçüëß Parent &amp; Student</button>
        </div>
        <div class="filter-right">
          <input type="text" class="search-input" id="searchInput" placeholder="üîé Search activities...">
          <button class="add-btn" id="addActBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Aktivite Ekle
          </button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TIMELINE ‚ïê‚ïê -->
      <div class="timeline-outer" id="timelineOuter">
        <div class="timeline-table" id="timelineTable">
          <!-- Built by JS -->
        </div>
      </div>

      <!-- ‚ïê‚ïê LEGEND ‚ïê‚ïê -->
      <div class="legend" id="legend"></div>
    </main>

    <!-- Scroll to today -->
    <button class="today-btn" id="todayBtn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 8 12 12 14 14"/></svg>
      Go to Today
    </button>

    <!-- ‚ïê‚ïê ACTIVITY DETAIL MODAL ‚ïê‚ïê -->
    <div class="modal-overlay" id="detailModal">
      <div class="modal-box">
        <div class="modal-header">
          <div class="modal-header-top">
            <div class="modal-title" id="detailTitle"></div>
            <button class="modal-close" id="detailClose"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
          </div>
          <div class="modal-badges" id="detailBadges"></div>
        </div>
        <div class="modal-body">
          <div class="modal-info-grid">
            <div class="modal-info-item"><div class="modal-info-label">üìÖ Date Range</div><div class="modal-info-value" id="detailDate"></div></div>
            <div class="modal-info-item"><div class="modal-info-label">üè´ Schools</div><div class="modal-info-value" id="detailSchools"></div></div>
            <div class="modal-info-item"><div class="modal-info-label">‚è± Duration</div><div class="modal-info-value" id="detailDuration"></div></div>
            <div class="modal-info-item"><div class="modal-info-label">üë§ Added By</div><div class="modal-info-value" id="detailCreatedBy"></div></div>
          </div>
          <div>
            <div class="modal-section-title">Description</div>
            <div class="modal-description" id="detailDesc">‚Äî</div>
          </div>
          <div id="detailDocsSection">
            <div class="modal-section-title">üìé Documents &amp; Resources</div>
            <div class="doc-list" id="detailDocs"></div>
          </div>
          <div id="detailCompletionSection">
            <div class="modal-section-title">‚úÖ Completion Status</div>
            <div class="completion-bar-wrap">
              <div class="completion-bar-label"><span id="compBarLabel">0/15 schools completed</span><span id="compBarPct">0%</span></div>
              <div class="completion-bar-track"><div class="completion-bar-fill" id="compBarFill" style="width:0%"></div></div>
            </div>
            <div class="school-completions" id="schoolCompList"></div>
          </div>
          <div id="detailMyComp">
            <div class="modal-section-title">üìù My School</div>
            <div class="my-completion">
              <div class="my-comp-top">
                <span class="my-comp-label">Mark as Completed?</span>
                <button class="toggle-btn pending" id="myCompToggle">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                  <span id="myCompLabel">Mark as Completed</span>
                </button>
              </div>
              <textarea class="notes-area" id="myCompNotes" placeholder="Notes or comments... (optional)"></textarea>
              <div style="display:flex;justify-content:flex-end;margin-top:8px;">
                <button class="btn btn-success" id="saveCompBtn">üíæ Save</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer" id="detailFooter">
          <button class="btn btn-danger" id="detailDeleteBtn" style="display:none;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/></svg>
            Sil
          </button>
          <button class="btn btn-ghost" id="detailEditBtn" style="display:none;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            Edit
          </button>
          <button class="btn btn-ghost" onclick="document.getElementById('detailModal').classList.remove('open')">Close</button>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê ADD / EDIT MODAL ‚ïê‚ïê -->
    <div class="modal-overlay modal-form" id="editModal">
      <div class="modal-box">
        <div class="modal-header">
          <div class="modal-header-top">
            <div class="modal-title" id="editModalTitle">Yeni Aktivite Ekle</div>
            <button class="modal-close" id="editClose"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
          </div>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editId">
          <div class="form-grid">
            <div class="form-group full">
              <label class="form-label">Activity Title *</label>
              <input type="text" class="form-input" id="editTitle" placeholder="E.g.: EASE-I Primary Assessment">
            </div>
            <div class="form-group">
              <label class="form-label">Category *</label>
              <select class="form-select" id="editCategory">
                <option value="assessment">üìä Assessment</option>
                <option value="training">üéì Training &amp; PD</option>
                <option value="visit">üè´ Okul Ziyareti</option>
                <option value="report">üìã Raporlama</option>
                <option value="event">üéâ Etkinlik</option>
                <option value="parent">üë®‚Äçüë©‚Äçüëß Parent &amp; Student</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Priority</label>
              <select class="form-select" id="editPriority">
                <option value="high">üî¥ High</option>
                <option value="medium" selected>üü° Medium</option>
                <option value="low">üü¢ Low</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Start Month *</label>
              <select class="form-select" id="editMonthStart"></select>
            </div>
            <div class="form-group">
              <label class="form-label">Start Week *</label>
              <select class="form-select" id="editWeekStart">
                <option value="1">Week 1</option><option value="2">Week 2</option>
                <option value="3">Week 3</option><option value="4">Week 4</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">End Month *</label>
              <select class="form-select" id="editMonthEnd"></select>
            </div>
            <div class="form-group">
              <label class="form-label">End Week *</label>
              <select class="form-select" id="editWeekEnd">
                <option value="1">Week 1</option><option value="2">Week 2</option>
                <option value="3">Week 3</option><option value="4">Week 4</option>
              </select>
            </div>
            <div class="form-group full">
              <label class="form-label">Description</label>
              <textarea class="form-textarea" id="editDesc" placeholder="Activity description, requirements, responsible parties..."></textarea>
            </div>
            <div class="form-group full">
              <label class="form-label">Applicable Schools</label>
              <div class="schools-select-wrap">
                <div class="schools-toggle">
                  <button type="button" class="schools-toggle-btn active" id="schoolsAllBtn">All Schools</button>
                  <button type="button" class="schools-toggle-btn" id="schoolsSelectBtn">Specific Schools</button>
                </div>
                <div id="schoolsMultiWrap" style="display:none;">
                  <select class="form-select" id="editSchools" multiple style="height:120px;">
                  </select>
                  <div style="font-size:11px;color:rgba(255,255,255,.4);margin-top:4px;">Hold Ctrl/Cmd to select multiple</div>
                </div>
              </div>
            </div>
            <div class="form-group full">
              <label class="form-label">üìé Documents &amp; Links</label>
              <div class="doc-list-form" id="docListForm"></div>
              <button type="button" class="add-doc-btn" id="addDocBtn" style="margin-top:8px;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="width:13px;height:13px;"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Add Document / Link
              </button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-ghost" id="editCancelBtn">Cancel</button>
          <button class="btn btn-primary" id="editSaveBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            Kaydet
          </button>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê LOADING ‚ïê‚ïê -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="spinner"></div>
      <div class="loading-text">Loading...</div>
    </div>

    <!-- ‚ïê‚ïê ENV ‚ïê‚ïê -->
    <script>
      window.ENV = {
        FIREBASE_API_KEY: "__FIREBASE_API_KEY__",
        FIREBASE_AUTH_DOMAIN: "__FIREBASE_AUTH_DOMAIN__",
        FIREBASE_PROJECT_ID: "__FIREBASE_PROJECT_ID__",
        FIREBASE_STORAGE_BUCKET: "__FIREBASE_STORAGE_BUCKET__",
        FIREBASE_MESSAGING_SENDER_ID: "__FIREBASE_MESSAGING_SENDER_ID__",
        FIREBASE_APP_ID: "__FIREBASE_APP_ID__",
      };
    </script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAuth, onAuthStateChanged, signOut, EmailAuthProvider, reauthenticateWithCredential, updatePassword }
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import { getFirestore, collection, query, orderBy, onSnapshot, addDoc, updateDoc,
        deleteDoc, doc, getDoc, setDoc, getDocs, where, serverTimestamp, limit }
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // ‚îÄ‚îÄ Firebase init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const app  = initializeApp({ apiKey:window.ENV.FIREBASE_API_KEY, authDomain:window.ENV.FIREBASE_AUTH_DOMAIN, projectId:window.ENV.FIREBASE_PROJECT_ID, storageBucket:window.ENV.FIREBASE_STORAGE_BUCKET, messagingSenderId:window.ENV.FIREBASE_MESSAGING_SENDER_ID, appId:window.ENV.FIREBASE_APP_ID });
      const auth = getAuth(app);
      const db   = getFirestore(app);

      // ‚îÄ‚îÄ Constants ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const WEEK_W = 130; // px per week column

      const MONTHS = [
        { name:'July',      short:'Jul', year:2025, num:7  },
        { name:'August',    short:'Aug', year:2025, num:8  },
        { name:'September', short:'Sep', year:2025, num:9  },
        { name:'October',   short:'Oct', year:2025, num:10 },
        { name:'November',  short:'Nov', year:2025, num:11 },
        { name:'December',  short:'Dec', year:2025, num:12 },
        { name:'January',   short:'Jan', year:2026, num:1  },
        { name:'February',  short:'Feb', year:2026, num:2  },
        { name:'March',     short:'Mar', year:2026, num:3  },
        { name:'April',     short:'Apr', year:2026, num:4  },
        { name:'May',       short:'May', year:2026, num:5  },
      ];

      const CATS = {
        assessment:{ label:'Assessment', en:'Assessment',      color:'#667eea', bg:'rgba(102,126,234,.18)', border:'rgba(102,126,234,.55)', icon:'üìä' },
        training:  { label:'Training & PD',   en:'Training & PD',   color:'#11998e', bg:'rgba(17,153,142,.18)',  border:'rgba(17,153,142,.55)',  icon:'üéì' },
        visit:     { label:'School Visit', en:'School Visit',    color:'#f5576c', bg:'rgba(245,87,108,.18)', border:'rgba(245,87,108,.55)', icon:'üè´' },
        report:    { label:'Reporting',     en:'Reporting',       color:'#f7971e', bg:'rgba(247,151,30,.18)',  border:'rgba(247,151,30,.55)',  icon:'üìã' },
        event:     { label:'Events',      en:'Events',          color:'#4facfe', bg:'rgba(79,172,254,.18)', border:'rgba(79,172,254,.55)', icon:'üéâ' },
        parent:    { label:'Parent & Student',en:'Parent & Student',color:'#a855f7', bg:'rgba(168,85,247,.18)', border:'rgba(168,85,247,.55)', icon:'üë®‚Äçüë©‚Äçüëß' },
      };

      const PRIORITY = { high:{label:'High',color:'#ef4444'}, medium:{label:'Medium',color:'#f59e0b'}, low:{label:'Low',color:'#10b981'} };

      const SCHOOLS = ['Al-Azhar BSD','Al-Azhar Rawamangun','Al-Azhar Kelapa Gading','SDIT Nurul Fikri','SDIT Al-Fath','SMPIT Ummul Quro','SMP IT Al-Kausar','SMA IT Al-Irsyad','SD Islam Al-Azhar 43','SMP Al-Irsyad','SD IT Bina Insan','SMP IT Bina Insan','SD Islam Terpadu','SMP Islam Terpadu','SMA Islam Terpadu'];

      const DEMO = [
        { title:'Teacher Orientation Week', category:'training', priority:'high', monthStart:0, weekStart:1, monthEnd:0, weekEnd:2, description:'Pre-academic year orientation and preparation week for all teachers. Cambridge methodology, school policies and annual goals are shared.', schools:'all', documents:[{title:'Orientation Programme',url:'#',type:'pdf'},{title:'Cambridge Guidelines 2025',url:'#',type:'pdf'}] },
        { title:'New Student Orientation', category:'event', priority:'medium', monthStart:0, weekStart:4, monthEnd:0, weekEnd:4, description:'School orientation event for newly enrolled students and their families.', schools:'all', documents:[{title:'Orientation Schedule',url:'#',type:'pdf'}] },
        { title:'Professional Development Day', category:'training', priority:'high', monthStart:1, weekStart:1, monthEnd:1, weekEnd:1, description:'Professional development day focused on Cambridge International education. Guest trainers and workshop sessions.', schools:'all', documents:[{title:'PD Day Agenda',url:'#',type:'pdf'},{title:'Workshop Materials',url:'#',type:'folder'}] },
        { title:'School Appraisal Round 1', category:'visit', priority:'high', monthStart:1, weekStart:3, monthEnd:2, weekEnd:1, description:'First semester inspection and evaluation visits by the Eduversal team to partner schools. Each school receives approximately 2 days of visits.', schools:'all', documents:[{title:'Appraisal Framework',url:'#',type:'pdf'},{title:'Observation Form',url:'#',type:'docx'},{title:'Self-Evaluation Template',url:'#',type:'docx'}] },
        { title:'EASE-I Primary Assessment', category:'assessment', priority:'high', monthStart:2, weekStart:2, monthEnd:2, weekEnd:3, description:'Semester 1 EASE-I Primary (SD/Grade 1-6) standardised assessment exams. Mathematics, Bahasa Indonesia, English and Science subjects.', schools:'all', documents:[{title:'EASE-I Primary Guidelines',url:'#',type:'pdf'},{title:'Score Sheet Template',url:'#',type:'xlsx'},{title:'Admin Manual',url:'#',type:'pdf'}] },
        { title:'EASE-I Lower Secondary', category:'assessment', priority:'high', monthStart:2, weekStart:2, monthEnd:2, weekEnd:3, description:'Semester 1 EASE-I Lower Secondary (SMP/Grade 7-9) assessment exams.', schools:'all', documents:[{title:'EASE-I Secondary Guidelines',url:'#',type:'pdf'},{title:'Score Sheet',url:'#',type:'xlsx'}] },
        { title:'Cambridge Mid-Year Checkpoint', category:'assessment', priority:'medium', monthStart:3, weekStart:1, monthEnd:3, weekEnd:2, description:'Cambridge Primary & Lower Secondary Checkpoint exams. Mid-term evaluation within the Cambridge programme framework.', schools:'all', documents:[{title:'Checkpoint Schedule',url:'#',type:'pdf'},{title:'Result Submission Form',url:'#',type:'xlsx'}] },
        { title:'Parent-Teacher Conference (PTC)', category:'parent', priority:'high', monthStart:4, weekStart:2, monthEnd:4, weekEnd:2, description:'Parent-Teacher Conference held simultaneously across all schools. Semester 1 academic progress reports shared.', schools:'all', documents:[{title:'PTC Guide for Schools',url:'#',type:'pdf'}] },
        { title:'Science & Arts Exhibition', category:'event', priority:'medium', monthStart:4, weekStart:4, monthEnd:4, weekEnd:4, description:'Annual exhibition where students showcase their science projects and artwork.', schools:'all', documents:[] },
        { title:'Student Satisfaction Survey', category:'parent', priority:'medium', monthStart:4, weekStart:3, monthEnd:4, weekEnd:4, description:'Student school satisfaction survey period. Conducted via online platform.', schools:'all', documents:[{title:'Survey Link & Instructions',url:'#',type:'link'}] },
        { title:'Staff Satisfaction Survey', category:'parent', priority:'medium', monthStart:5, weekStart:1, monthEnd:5, weekEnd:1, description:'Teacher and school staff satisfaction survey period.', schools:'all', documents:[{title:'Staff Survey Form',url:'#',type:'link'}] },
        { title:'Semester 1 Report Submission', category:'report', priority:'high', monthStart:5, weekStart:3, monthEnd:5, weekEnd:3, description:'Deadline for all partner schools to upload Semester 1 academic reports to the Eduversal portal.', schools:'all', documents:[{title:'Report Template',url:'#',type:'docx'},{title:'Submission Guidelines',url:'#',type:'pdf'}] },
        { title:'School Improvement Planning Day', category:'training', priority:'medium', monthStart:6, weekStart:2, monthEnd:6, weekEnd:2, description:'Workshop day for Semester 2 planning and updating school improvement goals.', schools:'all', documents:[{title:'SIP Template 2026',url:'#',type:'docx'}] },
        { title:'EASE-II Assessment', category:'assessment', priority:'high', monthStart:7, weekStart:2, monthEnd:7, weekEnd:3, description:'Semester 2 EASE-II assessment exams. Covers all Primary and Lower Secondary levels.', schools:'all', documents:[{title:'EASE-II Guidelines',url:'#',type:'pdf'},{title:'EASE-II Score Sheet',url:'#',type:'xlsx'}] },
        { title:'Parent Satisfaction Survey Q2', category:'parent', priority:'medium', monthStart:7, weekStart:4, monthEnd:8, weekEnd:1, description:'Semester 2 parent satisfaction survey period.', schools:'all', documents:[{title:'Parent Survey Form',url:'#',type:'link'}] },
        { title:'Cambridge Exam Prep Workshop', category:'training', priority:'high', monthStart:8, weekStart:1, monthEnd:8, weekEnd:2, description:'Teacher workshop programme in preparation for Cambridge IGCSE and A-Level exams.', schools:'all', documents:[{title:'Cambridge Exam Calendar',url:'#',type:'pdf'},{title:'Past Papers Package',url:'#',type:'folder'}] },
        { title:'School Appraisal Round 2', category:'visit', priority:'high', monthStart:8, weekStart:3, monthEnd:9, weekEnd:1, description:'Second semester inspection visits by the Eduversal team. School improvement plan progress evaluation.', schools:'all', documents:[{title:'Appraisal Round 2 Framework',url:'#',type:'pdf'},{title:'Observation Form R2',url:'#',type:'docx'}] },
        { title:'Cambridge Exams (IGCSE & A-Level)', category:'assessment', priority:'high', monthStart:10, weekStart:1, monthEnd:10, weekEnd:2, description:'Official Cambridge International IGCSE and A-Level examinations. Critical assessment period for all partner schools.', schools:'all', documents:[{title:'Cambridge Exam Timetable',url:'#',type:'pdf'},{title:'Invigilation Guidelines',url:'#',type:'pdf'},{title:'Cambridge Centre Admin Guide',url:'#',type:'pdf'}] },
        { title:'Semester 2 Report Submission', category:'report', priority:'high', monthStart:10, weekStart:3, monthEnd:10, weekEnd:3, description:'Deadline for all partner schools to upload year-end academic reports and Cambridge results analyses.', schools:'all', documents:[{title:'Year-End Report Template',url:'#',type:'docx'},{title:'Annual Review Form',url:'#',type:'docx'}] },
        { title:'End-of-Year Ceremony & Graduation', category:'event', priority:'high', monthStart:10, weekStart:4, monthEnd:10, weekEnd:4, description:'Year-end graduation ceremony and school closing event. Includes the Eduversal awards ceremony.', schools:'all', documents:[] },
      ];

      // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      let currentUser  = null;
      let isAdmin      = false;
      let isModerator  = false;
      let userSchool   = null;
      let allActivities = [];
      let myCompletions = {}; // activityId ‚Üí {completed, notes}
      let activeFilter = 'all';
      let searchTerm   = '';
      let currentDetailId = null;
      let unsubActivities = null;

      // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function weekIdx(mIdx, wNum) { return mIdx * 4 + (wNum - 1); }
      function totalWeeks(a) { return weekIdx(a.monthEnd, a.weekEnd) - weekIdx(a.monthStart, a.weekStart) + 1; }
      function monthLabel(idx) { return `${MONTHS[idx].short} ${MONTHS[idx].year}`; }
      function formatDateRange(a) {
        const s = MONTHS[a.monthStart]; const e = MONTHS[a.monthEnd];
        if (a.monthStart === a.monthEnd) return `${s.name} ${s.year} ¬∑ W${a.weekStart}${a.weekStart !== a.weekEnd ? '‚ÄìW'+a.weekEnd : ''}`;
        return `${s.name} W${a.weekStart} ‚Äì ${e.name} W${a.weekEnd} ${e.year}`;
      }
      function docTypeIcon(t) { return {pdf:'üìÑ',xlsx:'üìä',docx:'üìù',link:'üîó',folder:'üìÅ'}[t] || 'üìé'; }
      function docIconClass(t){ return `doc-icon-${t||'pdf'}`; }

      function getTodayWeekIdx() {
        const d = new Date(); const m = d.getMonth()+1; const y = d.getFullYear();
        const mi = MONTHS.findIndex(x => x.num===m && x.year===y);
        if (mi===-1) return -1;
        return weekIdx(mi, Math.min(Math.ceil(d.getDate()/7), 4));
      }

      function assignLanes(acts) {
        const sorted = [...acts].sort((a,b) => weekIdx(a.monthStart,a.weekStart) - weekIdx(b.monthStart,b.weekStart));
        const laneEnds = [];
        return sorted.map(act => {
          const si = weekIdx(act.monthStart, act.weekStart);
          const ei = weekIdx(act.monthEnd, act.weekEnd);
          let lane = laneEnds.findIndex(e => e < si);
          if (lane===-1){ lane=laneEnds.length; laneEnds.push(ei); } else { laneEnds[lane]=ei; }
          return {...act, lane};
        });
      }

      function filterActivities() {
        return allActivities.filter(a => {
          const catOk = activeFilter==='all' || a.category===activeFilter;
          const q = searchTerm.toLowerCase();
          const searchOk = !q || a.title.toLowerCase().includes(q) || (a.description||'').toLowerCase().includes(q);
          return catOk && searchOk;
        });
      }

      // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      onAuthStateChanged(auth, async user => {
        if (!user) { window.location.href = 'index.html'; return; }
        currentUser = user;
        try {
          const ud = await getDoc(doc(db,'users',user.uid));
          if (ud.exists()) {
            const d = ud.data();
            isAdmin     = d.isAdmin === true;
            isModerator = d.isModerator === true || isAdmin;
            userSchool  = d.schoolName || null;
            const name  = (d.displayName||user.displayName||user.email).split(' ')[0];
            document.getElementById('navFirstName').textContent = name;
            document.getElementById('navAvatar').textContent    = name[0].toUpperCase();
            document.getElementById('ddFullName').textContent   = d.displayName||user.displayName||'';
            document.getElementById('ddEmail').textContent      = user.email;
            document.getElementById('ddAvatar').textContent     = name[0].toUpperCase();
            if (d.phone) document.getElementById('ddPhone').value = d.phone;
            if (d.isAdmin || d.isModerator) document.getElementById('addActBtn').style.display='flex';
            // Show PW section for email/password users
            if (user.providerData.some(p=>p.providerId==='password')) document.getElementById('ddPwSection').style.display='block';
          }
        } catch(e){ console.warn(e); }
        document.getElementById('profileWrap').style.display='flex';
        setupNav();
        loadActivities();
        loadNavBadges();
        loadMyCompletions();
      });

      // ‚îÄ‚îÄ Load activities ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function loadActivities() {
        const ref = collection(db,'timeline_activities');
        // No compound orderBy ‚Üí no composite index needed; we sort client-side in assignLanes()
        const q   = query(ref);
        if (unsubActivities) unsubActivities();
        unsubActivities = onSnapshot(q, snap => {
          allActivities = snap.docs.map(d => ({id:d.id, ...d.data()}));
          if (allActivities.length === 0) seedDemo();
          else { renderTimeline(); renderStats(); }
          document.getElementById('loadingOverlay').style.display='none';
        }, err => {
          console.error('Firestore load error:', err);
          document.getElementById('loadingOverlay').innerHTML =
            '<div style="color:#ef4444;text-align:center;padding:2rem;">‚ö†Ô∏è Could not load activities.<br><small>'+err.message+'</small></div>';
        });
      }

      async function loadMyCompletions() {
        if (!currentUser) return;
        const q = query(collection(db,'timeline_completions'), where('userId','==',currentUser.uid));
        const snap = await getDocs(q);
        myCompletions = {};
        snap.forEach(d => { myCompletions[d.data().activityId] = d.data(); });
      }

      async function seedDemo() {
        for (const act of DEMO) {
          await addDoc(collection(db,'timeline_activities'), { ...act, createdBy:'system', createdAt:serverTimestamp() });
        }
      }

      // ‚îÄ‚îÄ Render Timeline ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderTimeline() {
        const table = document.getElementById('timelineTable');
        table.innerHTML = '';
        const filtered = filterActivities();
        const totalW = MONTHS.length * 4 * WEEK_W;

        // ‚îÄ‚îÄ Month header row ‚îÄ‚îÄ
        const mRow = document.createElement('div');
        mRow.className = 'tl-month-row';
        const corner = document.createElement('div');
        corner.className = 'tl-corner';
        corner.textContent = 'Category';
        mRow.appendChild(corner);
        const todayMi = (() => { const d=new Date(); return MONTHS.findIndex(x=>x.num===d.getMonth()+1&&x.year===d.getFullYear()); })();
        MONTHS.forEach((m,mi) => {
          const cell = document.createElement('div');
          cell.className = 'tl-month-cell' + (mi===todayMi?' current-month':'');
          cell.style.width = (4*WEEK_W)+'px';
          cell.style.minWidth = (4*WEEK_W)+'px';
          cell.textContent = `${m.name} ${m.year}`;
          mRow.appendChild(cell);
        });
        table.appendChild(mRow);

        // ‚îÄ‚îÄ Week header row ‚îÄ‚îÄ
        const wRow = document.createElement('div');
        wRow.className = 'tl-week-row';
        const corner2 = document.createElement('div');
        corner2.className = 'tl-corner-2';
        wRow.appendChild(corner2);
        const todayWi = getTodayWeekIdx();
        MONTHS.forEach((_,mi) => {
          for (let w=1; w<=4; w++) {
            const wi = weekIdx(mi,w);
            const cell = document.createElement('div');
            cell.className = 'tl-week-cell' + (wi===todayWi?' current-week':'');
            cell.style.width = WEEK_W+'px';
            cell.textContent = `W${w}`;
            wRow.appendChild(cell);
          }
        });
        table.appendChild(wRow);

        // ‚îÄ‚îÄ Category lane rows ‚îÄ‚îÄ
        Object.entries(CATS).forEach(([catKey, catDef]) => {
          const catActs = filtered.filter(a => a.category===catKey);
          const withLanes = assignLanes(catActs);
          const maxLane   = withLanes.length ? Math.max(...withLanes.map(a=>a.lane)) : -1;
          const rowH      = Math.max(68, (maxLane+1) * 44 + 24);

          const laneRow = document.createElement('div');
          laneRow.className = 'tl-lane-row';
          laneRow.id = `lane-row-${catKey}`;
          if (activeFilter!=='all' && activeFilter!==catKey) laneRow.style.opacity='0.3';

          // Label
          const label = document.createElement('div');
          label.className = 'tl-label';
          label.innerHTML = `
            <div class="tl-label-icon">${catDef.icon}</div>
            <div class="tl-label-text">${catDef.en}</div>
            
            <div class="tl-label-count" style="background:${catDef.color}33;color:${catDef.color};border:1px solid ${catDef.border};">${catActs.length}</div>`;
          label.addEventListener('click', () => {
            activeFilter = activeFilter===catKey ? 'all' : catKey;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`.filter-btn[data-cat="${activeFilter}"]`);
            if (btn) { btn.classList.add('active'); applyFilterBtnStyle(btn, activeFilter); }
            renderTimeline();
          });
          laneRow.appendChild(label);

          // Bar area
          const barArea = document.createElement('div');
          barArea.className = 'tl-bar-area';
          barArea.style.width = totalW+'px';
          barArea.style.minWidth = totalW+'px';
          barArea.style.minHeight = rowH+'px';
          barArea.style.position = 'relative';

          // Month dividers
          MONTHS.forEach((_,mi) => {
            if (mi===0) return;
            const div = document.createElement('div');
            div.className = 'month-div';
            div.style.left = (mi*4*WEEK_W)+'px';
            barArea.appendChild(div);
          });

          // Today line (only on first lane)
          if (catKey==='assessment' && todayWi>=0) {
            const tl = document.createElement('div');
            tl.className = 'today-line';
            tl.style.left = (todayWi*WEEK_W + WEEK_W/2)+'px';
            tl.innerHTML = `<div class="today-dot"></div><div class="today-line-inner"></div>`;
            barArea.appendChild(tl);
          }

          // Empty state
          if (catActs.length===0) {
            const emp = document.createElement('div');
            emp.className = 'empty-lane';
            emp.textContent = 'No activities in this category';
            barArea.appendChild(emp);
          }

          // Activity bars
          withLanes.forEach(act => {
            const si = weekIdx(act.monthStart, act.weekStart);
            const ei = weekIdx(act.monthEnd, act.weekEnd);
            const left  = si * WEEK_W + 4;
            const width = (ei - si + 1) * WEEK_W - 8;
            const top   = act.lane * 44 + 8;
            const pColor = (PRIORITY[act.priority]||PRIORITY.medium).color;
            const myComp = myCompletions[act.id];

            const bar = document.createElement('div');
            bar.className = 'act-bar';
            bar.style.cssText = `left:${left}px;width:${width}px;top:${top}px;background:${catDef.bg};border:1px solid ${catDef.border};`;
            if (myComp?.completed) bar.style.opacity='0.6';
            bar.innerHTML = `
              <div class="act-bar-priority" style="background:${pColor};box-shadow:0 0 6px ${pColor}88;"></div>
              <div class="act-bar-title">${act.title}</div>
              ${width>160?`<div class="act-bar-weeks">${totalWeeks(act)}w</div>`:''}`;
            bar.addEventListener('click', () => openDetailModal(act.id));
            bar.title = act.title;
            barArea.appendChild(bar);
          });

          laneRow.appendChild(barArea);
          table.appendChild(laneRow);
        });

        // Scroll to today on first render
        if (todayWi >= 0) {
          const outer = document.getElementById('timelineOuter');
          const labelW = 210; // --label-width
          const targetScroll = labelW + todayWi*WEEK_W - outer.clientWidth/2 + WEEK_W/2;
          setTimeout(() => { outer.scrollLeft = Math.max(0, targetScroll); }, 100);
        }

        renderLegend();
      }

      // ‚îÄ‚îÄ Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderStats() {
        const total = allActivities.length;
        const completed = Object.values(myCompletions).filter(c=>c.completed).length;
        const today = new Date();
        const mi = MONTHS.findIndex(x=>x.num===today.getMonth()+1&&x.year===today.getFullYear());
        const thisMonth = mi>=0 ? allActivities.filter(a=>a.monthStart<=mi&&a.monthEnd>=mi).length : 0;
        const upcoming = allActivities.filter(a=>{
          const si = weekIdx(a.monthStart,a.weekStart);
          const ti = getTodayWeekIdx();
          return si>=ti && si<=ti+4;
        }).length;
        document.getElementById('statTotal').textContent     = total;
        document.getElementById('statCompleted').textContent = completed;
        document.getElementById('statThisMonth').textContent = thisMonth;
        document.getElementById('statUpcoming').textContent  = upcoming;
      }

      // ‚îÄ‚îÄ Legend ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderLegend() {
        const lg = document.getElementById('legend');
        lg.innerHTML = '';
        Object.entries(CATS).forEach(([,c]) => {
          const li = document.createElement('div');
          li.className='legend-item';
          li.innerHTML=`<div class="legend-dot" style="background:${c.color};"></div>${c.icon} ${c.label}`;
          lg.appendChild(li);
        });
        ['high','medium','low'].forEach(p => {
          const pc = PRIORITY[p];
          const li = document.createElement('div');
          li.className='legend-item';
          li.innerHTML=`<div class="legend-dot" style="background:${pc.color}; border-radius:50%;"></div>${pc.label} Priority`;
          lg.appendChild(li);
        });
        const tli = document.createElement('div');
        tli.className='legend-item';
        tli.innerHTML=`<div class="legend-dot" style="background:#ff6b6b;border-radius:50%;"></div>Today`;
        lg.appendChild(tli);
      }

      // ‚îÄ‚îÄ Detail Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function openDetailModal(id) {
        currentDetailId = id;
        const act = allActivities.find(a=>a.id===id);
        if (!act) return;
        const cat = CATS[act.category] || CATS.assessment;
        const pri = PRIORITY[act.priority] || PRIORITY.medium;

        document.getElementById('detailTitle').textContent = act.title;
        document.getElementById('detailDate').textContent  = formatDateRange(act);
        document.getElementById('detailDuration').textContent = `${totalWeeks(act)} week(s)`;
        document.getElementById('detailSchools').textContent  = act.schools==='all' ? 'All Partner Schools' : (act.schools||[]).join(', ');
        document.getElementById('detailDesc').textContent     = act.description || '‚Äî';
        document.getElementById('detailCreatedBy').textContent= act.createdBy==='system'?'Eduversal (Demo)':'Eduversal Management';

        // Badges
        const badges = document.getElementById('detailBadges');
        badges.innerHTML = `
          <span class="badge" style="background:${cat.bg};color:${cat.color};border:1px solid ${cat.border};">${cat.icon} ${cat.label}</span>
          <span class="badge badge-priority-${act.priority}">${pri.label} Priority</span>`;

        // Documents
        const docs = act.documents||[];
        const docsSection = document.getElementById('detailDocsSection');
        const docsList = document.getElementById('detailDocs');
        if (docs.length) {
          docsSection.style.display='block';
          docsList.innerHTML = docs.map(d=>`
            <a href="${d.url}" target="_blank" class="doc-item">
              <div class="doc-icon ${docIconClass(d.type)}">${docTypeIcon(d.type)}</div>
              <div style="flex:1;min-width:0;"><div class="doc-name">${d.title}</div><div class="doc-type">${d.type||'dosya'}</div></div>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;color:rgba(255,255,255,.35);flex-shrink:0;"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
            </a>`).join('');
        } else { docsSection.style.display='none'; }

        // Completions
        await loadCompletionData(id);

        // My completion
        const myComp = myCompletions[id];
        const toggle = document.getElementById('myCompToggle');
        const compLabel = document.getElementById('myCompLabel');
        toggle.className = myComp?.completed ? 'toggle-btn completed' : 'toggle-btn pending';
        compLabel.textContent = myComp?.completed ? 'Completed ‚úì' : 'Mark as Completed';
        document.getElementById('myCompNotes').value = myComp?.notes || '';

        // Admin buttons
        document.getElementById('detailEditBtn').style.display   = isModerator ? 'flex' : 'none';
        document.getElementById('detailDeleteBtn').style.display = isAdmin ? 'flex' : 'none';

        document.getElementById('detailModal').classList.add('open');
      }

      async function loadCompletionData(actId) {
        try {
          const q = query(collection(db,'timeline_completions'), where('activityId','==',actId));
          const snap = await getDocs(q);
          const comps = {};
          snap.forEach(d => { comps[d.data().schoolName || d.data().userId] = d.data(); });
          const done = Object.values(comps).filter(c=>c.completed).length;
          const total = SCHOOLS.length;
          const pct = Math.round(done/total*100);
          document.getElementById('compBarLabel').textContent = `${done}/${total} schools completed`;
          document.getElementById('compBarPct').textContent   = pct+'%';
          document.getElementById('compBarFill').style.width  = pct+'%';
          const list = document.getElementById('schoolCompList');
          list.innerHTML = SCHOOLS.map(s => {
            const c = Object.values(comps).find(x=>x.schoolName===s);
            return `<div class="school-comp-row">
              <div class="school-comp-check ${c?.completed?'done':'pending'}">${c?.completed?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>':''}</div>
              <div class="school-comp-name">${s}</div>
              ${c?.completed?`<div class="school-comp-date">${c.updatedAt?.toDate ? c.updatedAt.toDate().toLocaleDateString('tr-TR') : ''}</div>`:''}
            </div>`;
          }).join('');
        } catch(e) { console.warn(e); }
      }

      // Toggle completion
      document.getElementById('myCompToggle').addEventListener('click', () => {
        const btn = document.getElementById('myCompToggle');
        const lbl = document.getElementById('myCompLabel');
        const isDone = btn.classList.contains('completed');
        btn.className = isDone ? 'toggle-btn pending' : 'toggle-btn completed';
        lbl.textContent = isDone ? 'Mark as Completed' : 'Completed ‚úì';
      });

      document.getElementById('saveCompBtn').addEventListener('click', async () => {
        if (!currentDetailId || !currentUser) return;
        const isDone  = document.getElementById('myCompToggle').classList.contains('completed');
        const notes   = document.getElementById('myCompNotes').value.trim();
        const compId  = `${currentUser.uid}_${currentDetailId}`;
        await setDoc(doc(db,'timeline_completions',compId), {
          activityId: currentDetailId, userId: currentUser.uid,
          schoolName: userSchool || '', completed: isDone, notes,
          updatedAt: serverTimestamp()
        }, {merge:true});
        myCompletions[currentDetailId] = { activityId:currentDetailId, completed:isDone, notes };
        renderTimeline(); renderStats();
        await loadCompletionData(currentDetailId);
      });

      // Edit from detail
      document.getElementById('detailEditBtn').addEventListener('click', () => {
        const act = allActivities.find(a=>a.id===currentDetailId);
        if (act) { document.getElementById('detailModal').classList.remove('open'); openEditModal(act); }
      });

      // Delete
      document.getElementById('detailDeleteBtn').addEventListener('click', async () => {
        if (!confirm('Are you sure you want to delete this activity?')) return;
        await deleteDoc(doc(db,'timeline_activities',currentDetailId));
        document.getElementById('detailModal').classList.remove('open');
      });

      // ‚îÄ‚îÄ Edit/Add Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function openEditModal(act=null) {
        document.getElementById('editModalTitle').textContent = act ? 'Edit Activity' : 'Add New Activity';
        document.getElementById('editId').value        = act?.id || '';
        document.getElementById('editTitle').value     = act?.title || '';
        document.getElementById('editDesc').value      = act?.description || '';
        document.getElementById('editCategory').value  = act?.category || 'assessment';
        document.getElementById('editPriority').value  = act?.priority || 'medium';
        // Populate month selects
        ['editMonthStart','editMonthEnd'].forEach(id => {
          const sel = document.getElementById(id);
          sel.innerHTML = MONTHS.map((m,i)=>`<option value="${i}">${m.name} ${m.year}</option>`).join('');
        });
        document.getElementById('editMonthStart').value = act?.monthStart ?? 0;
        document.getElementById('editWeekStart').value  = act?.weekStart  ?? 1;
        document.getElementById('editMonthEnd').value   = act?.monthEnd   ?? 0;
        document.getElementById('editWeekEnd').value    = act?.weekEnd    ?? 1;
        // Schools
        const isAll = !act || act.schools==='all';
        document.getElementById('schoolsAllBtn').className    = isAll ? 'schools-toggle-btn active' : 'schools-toggle-btn';
        document.getElementById('schoolsSelectBtn').className = !isAll ? 'schools-toggle-btn active' : 'schools-toggle-btn';
        document.getElementById('schoolsMultiWrap').style.display = isAll ? 'none' : 'block';
        const sel = document.getElementById('editSchools');
        sel.innerHTML = SCHOOLS.map(s=>`<option value="${s}">${s}</option>`).join('');
        if (!isAll && Array.isArray(act.schools)) { act.schools.forEach(s => { const o=sel.querySelector(`option[value="${s}"]`); if(o)o.selected=true; }); }
        // Documents
        renderDocForm(act?.documents||[]);
        document.getElementById('editModal').classList.add('open');
      }

      let docFormItems = [];
      function renderDocForm(docs) {
        docFormItems = [...docs];
        const list = document.getElementById('docListForm');
        list.innerHTML = '';
        docFormItems.forEach((d,i) => {
          const row = document.createElement('div');
          row.className = 'doc-form-row';
          row.innerHTML = `
            <input type="text" class="form-input" placeholder="Document title" value="${d.title||''}" data-fi="${i}" data-field="title">
            <input type="text" class="form-input" placeholder="URL or link" value="${d.url||''}" data-fi="${i}" data-field="url" style="min-width:160px;">
            <select class="form-select" data-fi="${i}" data-field="type">
              ${['pdf','xlsx','docx','link','folder'].map(t=>`<option value="${t}" ${d.type===t?'selected':''}>${t}</option>`).join('')}
            </select>
            <button type="button" class="doc-remove-btn" data-ri="${i}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>`;
          list.appendChild(row);
        });
        list.querySelectorAll('input,select').forEach(el => el.addEventListener('change', e => {
          docFormItems[+e.target.dataset.fi][e.target.dataset.field] = e.target.value;
        }));
        list.querySelectorAll('.doc-remove-btn').forEach(btn => btn.addEventListener('click', e => {
          docFormItems.splice(+e.currentTarget.dataset.ri, 1);
          renderDocForm(docFormItems);
        }));
      }

      document.getElementById('addDocBtn').addEventListener('click', () => {
        docFormItems.push({title:'',url:'#',type:'pdf'});
        renderDocForm(docFormItems);
      });

      document.getElementById('schoolsAllBtn').addEventListener('click', () => {
        document.getElementById('schoolsAllBtn').className    = 'schools-toggle-btn active';
        document.getElementById('schoolsSelectBtn').className = 'schools-toggle-btn';
        document.getElementById('schoolsMultiWrap').style.display = 'none';
      });
      document.getElementById('schoolsSelectBtn').addEventListener('click', () => {
        document.getElementById('schoolsSelectBtn').className = 'schools-toggle-btn active';
        document.getElementById('schoolsAllBtn').className    = 'schools-toggle-btn';
        document.getElementById('schoolsMultiWrap').style.display = 'block';
      });

      document.getElementById('editSaveBtn').addEventListener('click', async () => {
        const title = document.getElementById('editTitle').value.trim();
        if (!title) { alert('Please enter a title.'); return; }
        const isAllSchools = document.getElementById('schoolsAllBtn').classList.contains('active');
        let schools = 'all';
        if (!isAllSchools) { schools = Array.from(document.getElementById('editSchools').selectedOptions).map(o=>o.value); }
        const data = {
          title, description: document.getElementById('editDesc').value.trim(),
          category:   document.getElementById('editCategory').value,
          priority:   document.getElementById('editPriority').value,
          monthStart: +document.getElementById('editMonthStart').value,
          weekStart:  +document.getElementById('editWeekStart').value,
          monthEnd:   +document.getElementById('editMonthEnd').value,
          weekEnd:    +document.getElementById('editWeekEnd').value,
          schools, documents: docFormItems.filter(d=>d.title),
        };
        const id = document.getElementById('editId').value;
        document.getElementById('editSaveBtn').textContent = 'Saving...';
        document.getElementById('editSaveBtn').disabled = true;
        try {
          if (id) { await updateDoc(doc(db,'timeline_activities',id),{...data,updatedAt:serverTimestamp(),updatedBy:currentUser.uid}); }
          else    { await addDoc(collection(db,'timeline_activities'),{...data,createdAt:serverTimestamp(),createdBy:currentUser.uid}); }
          document.getElementById('editModal').classList.remove('open');
        } catch(e) { alert('Save error: '+e.message); }
        document.getElementById('editSaveBtn').textContent = 'Save';
        document.getElementById('editSaveBtn').disabled = false;
      });

      document.getElementById('addActBtn').addEventListener('click', () => openEditModal(null));
      document.getElementById('editClose').addEventListener('click',  () => document.getElementById('editModal').classList.remove('open'));
      document.getElementById('editCancelBtn').addEventListener('click', () => document.getElementById('editModal').classList.remove('open'));
      document.getElementById('detailClose').addEventListener('click', () => document.getElementById('detailModal').classList.remove('open'));

      // Close on overlay click
      ['detailModal','editModal'].forEach(id => {
        document.getElementById(id).addEventListener('click', e => { if(e.target.id===id) document.getElementById(id).classList.remove('open'); });
      });

      // ‚îÄ‚îÄ Filters ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function applyFilterBtnStyle(btn, cat) {
        if (cat==='all') { btn.style.background='rgba(108,92,231,.18)'; btn.style.borderColor='rgba(108,92,231,.4)'; btn.style.color='#fff'; return; }
        const c = CATS[cat];
        if (c) { btn.style.background=c.bg; btn.style.borderColor=c.border; btn.style.color=c.color; }
      }

      document.getElementById('filterCats').addEventListener('click', e => {
        const btn = e.target.closest('.filter-btn');
        if (!btn) return;
        activeFilter = btn.dataset.cat;
        document.querySelectorAll('.filter-btn').forEach(b => { b.classList.remove('active'); b.style.background=''; b.style.borderColor=''; b.style.color=''; });
        btn.classList.add('active');
        applyFilterBtnStyle(btn, activeFilter);
        renderTimeline();
      });

      document.getElementById('searchInput').addEventListener('input', e => {
        searchTerm = e.target.value;
        renderTimeline();
      });

      // ‚îÄ‚îÄ Scroll to today ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      document.getElementById('todayBtn').addEventListener('click', () => {
        const outer = document.getElementById('timelineOuter');
        const wi = getTodayWeekIdx();
        if (wi>=0) outer.scrollTo({ left: 210 + wi*WEEK_W - outer.clientWidth/2 + WEEK_W/2, behavior:'smooth' });
      });

      // ‚îÄ‚îÄ Nav scroll effect ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      window.addEventListener('scroll', () => {
        document.getElementById('topNav').classList.toggle('scrolled', window.scrollY>10);
      });

      // ‚îÄ‚îÄ Nav badges ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function loadNavBadges() {
        try {
          const lastAnn = localStorage.getItem('lastSeenAnn') || '0';
          const qA = query(collection(db,'announcements'), orderBy('createdAt','desc'), limit(10));
          const snapA = await getDocs(qA);
          let unreadA = 0;
          snapA.forEach(d => { if((d.data().createdAt?.seconds||0) > +lastAnn) unreadA++; });
          if (unreadA) { const b=document.getElementById('annBadge'); b.textContent=unreadA; b.classList.add('visible'); }
          const lastMsg = localStorage.getItem('lastSeenMsg') || '0';
          const qM = query(collection(db,'topics'), orderBy('createdAt','desc'), limit(10));
          const snapM = await getDocs(qM);
          let unreadM = 0;
          snapM.forEach(d => { if((d.data().createdAt?.seconds||0) > +lastMsg) unreadM++; });
          if (unreadM) { const b=document.getElementById('msgBadge'); b.textContent=unreadM; b.classList.add('visible'); }
        } catch(e) {}
      }

      // ‚îÄ‚îÄ Profile dropdown ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function setupNav() {
        const wrap = document.getElementById('profileWrap');
        const btn  = document.getElementById('profileBtn');
        const dd   = document.getElementById('profileDropdown');
        btn.addEventListener('click', e => { e.stopPropagation(); wrap.classList.toggle('open'); });
        document.addEventListener('click', e => { if (!wrap.contains(e.target)) wrap.classList.remove('open'); });

        document.getElementById('ddSavePhone').addEventListener('click', async () => {
          const phone = document.getElementById('ddPhone').value.trim();
          const status = document.getElementById('ddPhoneStatus');
          try { await updateDoc(doc(db,'users',currentUser.uid),{phone}); status.textContent='‚úì Saved'; setTimeout(()=>status.textContent='',2000); }
          catch(e){ status.style.color='#ef4444'; status.textContent='Hata: '+e.message; }
        });

        const pwToggle = document.getElementById('ddPwToggle');
        const pwFields = document.getElementById('ddPwFields');
        pwToggle.addEventListener('click', () => {
          const open = pwFields.style.display==='flex';
          pwFields.style.display = open ? 'none' : 'flex';
          pwToggle.querySelector('svg').style.transform = open ? '' : 'rotate(180deg)';
        });

        document.getElementById('ddUpdatePwBtn').addEventListener('click', async () => {
          const cur = document.getElementById('ddCurrentPw').value;
          const nw  = document.getElementById('ddNewPw').value;
          const cf  = document.getElementById('ddConfirmPw').value;
          const st  = document.getElementById('ddPwStatus');
          if (nw!==cf){ st.style.color='#ef4444'; st.textContent='Passwords do not match.'; return; }
          if (nw.length<6){ st.style.color='#ef4444'; st.textContent='Minimum 6 characters.'; return; }
          try {
            const cred = EmailAuthProvider.credential(currentUser.email, cur);
            await reauthenticateWithCredential(currentUser, cred);
            await updatePassword(currentUser, nw);
            st.style.color='#10b981'; st.textContent='‚úì Password updated.';
            ['ddCurrentPw','ddNewPw','ddConfirmPw'].forEach(id => document.getElementById(id).value='');
          } catch(e){ st.style.color='#ef4444'; st.textContent='Error: '+e.message; }
        });

        document.getElementById('ddSignOut').addEventListener('click', async () => {
          await signOut(auth);
          window.location.href = 'index.html';
        });
      }
    </script>
  </body>
</html>
